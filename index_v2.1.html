<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OSHI Dashboard v2.1 ‚Äî Cross-Platform Trading</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&family=Rajdhani:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  /* Platform Colors */
  --kalshi-primary: #00d4aa;
  --kalshi-light: #00ff88;
  --polymarket-primary: #0088ff;
  --polymarket-light: #00a8ff;
  
  /* Status Colors */
  --profit: #00d4aa;
  --loss: #ff4757;
  --neutral: #888888;
  --warning: #f7931a;
  
  /* Background */
  --bg-deep: #0a0a0f;
  --bg-card: linear-gradient(145deg, #12121a, #0d0d12);
  --border: #1a1a2e;
  --border-glow: rgba(0, 212, 170, 0.3);
  
  /* Text */
  --text-primary: #e8edf5;
  --text-secondary: #8892b0;
  --text-dim: #666;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg-deep);
  color: var(--text-primary);
  font-family: 'Rajdhani', sans-serif;
  min-height: 100vh;
  padding: 20px;
  line-height: 1.4;
}

/* === HEADER === */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 0;
  border-bottom: 1px solid var(--border);
  margin-bottom: 24px;
}

.logo-section {
  display: flex;
  align-items: center;
  gap: 16px;
}

.oshi-avatar {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--kalshi-primary), var(--polymarket-primary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  border: 2px solid var(--kalshi-primary);
  box-shadow: 0 0 20px rgba(0, 212, 170, 0.3);
}

.brand h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 24px;
  letter-spacing: 3px;
  background: linear-gradient(90deg, var(--kalshi-primary), var(--polymarket-primary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.brand .subtitle {
  font-size: 12px;
  color: var(--text-secondary);
  letter-spacing: 2px;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 20px;
}

.version-badge {
  background: var(--border);
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-family: 'Space Mono', monospace;
  color: var(--kalshi-primary);
  border: 1px solid var(--kalshi-primary);
}

.status-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--kalshi-primary);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(0, 212, 170, 0.4); }
  50% { opacity: 0.8; box-shadow: 0 0 0 8px rgba(0, 212, 170, 0); }
}

/* === BALANCE BAR === */
.balance-bar {
  display: flex;
  justify-content: center;
  gap: 40px;
  padding: 16px;
  background: var(--bg-card);
  border-radius: 12px;
  margin-bottom: 24px;
  border: 1px solid var(--border);
}

.balance-item {
  display: flex;
  align-items: center;
  gap: 10px;
}

.balance-item .icon {
  font-size: 20px;
}

.balance-item .label {
  font-size: 12px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.balance-item .value {
  font-family: 'Space Mono', monospace;
  font-size: 18px;
  font-weight: 700;
}

.balance-item.kalshi .value { color: var(--kalshi-primary); }
.balance-item.polymarket .value { color: var(--polymarket-primary); }

/* === PLATFORM GRID === */
.platform-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-bottom: 24px;
}

.platform-card {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 24px;
  border: 1px solid var(--border);
  position: relative;
  overflow: hidden;
  transition: transform 0.3s, box-shadow 0.3s;
}

.platform-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
}

.platform-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
}

.platform-card.kalshi::before {
  background: linear-gradient(90deg, var(--kalshi-primary), var(--kalshi-light));
}

.platform-card.polymarket::before {
  background: linear-gradient(90deg, var(--polymarket-primary), var(--polymarket-light));
}

.platform-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.platform-name {
  display: flex;
  align-items: center;
  gap: 12px;
}

.platform-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.kalshi .platform-icon {
  background: rgba(0, 212, 170, 0.15);
  border: 1px solid var(--kalshi-primary);
}

.polymarket .platform-icon {
  background: rgba(0, 136, 255, 0.15);
  border: 1px solid var(--polymarket-primary);
}

.platform-label h2 {
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  letter-spacing: 2px;
}

.kalshi .platform-label h2 { color: var(--kalshi-primary); }
.polymarket .platform-label h2 { color: var(--polymarket-primary); }

.platform-label .timeframe {
  font-size: 12px;
  color: var(--text-dim);
}

.platform-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.stat-box {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
  padding: 20px 16px;
  text-align: center;
}

.stat-box.wide {
  grid-column: span 2;
}

.stat-value {
  font-family: 'Space Mono', monospace;
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 6px;
}

.stat-value.positive { color: var(--profit); }
.stat-value.negative { color: var(--loss); }
.stat-value.neutral { color: var(--neutral); }

.stat-label {
  font-size: 11px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* === ACTIVE POSITIONS === */
.active-positions {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 20px 24px;
  margin-bottom: 24px;
  border: 1px solid var(--border);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.section-header h3 {
  font-family: 'Orbitron', sans-serif;
  font-size: 14px;
  letter-spacing: 2px;
  color: var(--text-secondary);
}

.position-count {
  background: rgba(0, 212, 170, 0.1);
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  color: var(--kalshi-primary);
}

.positions-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.position-item {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 14px 16px;
  background: rgba(255, 255, 255, 0.02);
  border-radius: 10px;
  border-left: 3px solid transparent;
}

.position-item.kalshi { border-left-color: var(--kalshi-primary); }
.position-item.polymarket { border-left-color: var(--polymarket-primary); }

.position-platform {
  font-size: 18px;
}

.position-info {
  flex: 1;
}

.position-market {
  font-weight: 600;
  font-size: 14px;
}

.position-meta {
  font-size: 12px;
  color: var(--text-dim);
}

.position-pnl {
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  font-weight: 600;
}

.position-pnl.positive { color: var(--profit); }
.position-pnl.negative { color: var(--loss); }

.position-alert {
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 6px;
  background: rgba(247, 147, 26, 0.2);
  color: var(--warning);
}

.no-positions {
  text-align: center;
  padding: 30px;
  color: var(--text-dim);
  font-style: italic;
}

/* === CORRELATION MATRIX === */
.correlation-section {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 20px 24px;
  margin-bottom: 24px;
  border: 1px solid var(--border);
}

.correlation-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
}

.corr-item {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 10px;
  padding: 16px;
  text-align: center;
}

.corr-value {
  font-family: 'Space Mono', monospace;
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 6px;
}

.corr-value.high { color: var(--profit); }
.corr-value.medium { color: var(--warning); }
.corr-value.low { color: var(--loss); }

.corr-label {
  font-size: 10px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* === RECENT RESOLUTIONS === */
.recent-section {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 20px 24px;
  border: 1px solid var(--border);
}

.resolutions-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.resolution-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 16px;
  background: rgba(255, 255, 255, 0.02);
  border-radius: 10px;
  transition: background 0.2s;
}

.resolution-item:hover {
  background: rgba(255, 255, 255, 0.04);
}

.resolution-platform {
  font-size: 20px;
}

.resolution-info {
  flex: 1;
}

.resolution-market {
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 2px;
}

.resolution-meta {
  font-size: 11px;
  color: var(--text-dim);
}

.resolution-outcome {
  padding: 5px 12px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
}

.resolution-outcome.win {
  background: rgba(0, 212, 170, 0.15);
  color: var(--profit);
}

.resolution-outcome.loss {
  background: rgba(255, 71, 87, 0.15);
  color: var(--loss);
}

.resolution-pnl {
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  font-weight: 700;
  min-width: 80px;
  text-align: right;
}

.resolution-pnl.positive { color: var(--profit); }
.resolution-pnl.negative { color: var(--loss); }

/* === FOOTER === */
.footer {
  text-align: center;
  padding: 24px;
  color: var(--text-dim);
  font-size: 12px;
}

.footer a {
  color: var(--kalshi-primary);
  text-decoration: none;
}

.refresh-time {
  font-family: 'Space Mono', monospace;
  color: var(--text-secondary);
}

/* === RESPONSIVE === */
@media (max-width: 768px) {
  .platform-grid {
    grid-template-columns: 1fr;
  }
  
  .correlation-grid {
    grid-template-columns: 1fr 1fr;
  }
  
  .balance-bar {
    flex-direction: column;
    gap: 16px;
    align-items: center;
  }
  
  .header {
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }
}

/* === LOADING STATE === */
.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px;
  color: var(--text-dim);
}

.spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--border);
  border-top-color: var(--kalshi-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 12px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="logo-section">
    <div class="oshi-avatar">üëÅÔ∏è</div>
    <div class="brand">
      <h1>OSHI</h1>
      <div class="subtitle">CROSS-PLATFORM TRADING</div>
    </div>
  </div>
  <div class="header-right">
    <div class="version-badge">v9.0 + v1.2</div>
    <div class="status-dot" title="Live"></div>
  </div>
</header>

<!-- BALANCE BAR -->
<div class="balance-bar">
  <div class="balance-item kalshi">
    <span class="icon">üü¢</span>
    <div>
      <div class="label">Kalshi Balance</div>
      <div class="value" id="kalshiBalance">$--</div>
    </div>
  </div>
  <div class="balance-item polymarket">
    <span class="icon">üîµ</span>
    <div>
      <div class="label">Polymarket Balance</div>
      <div class="value" id="polyBalance">$--</div>
    </div>
  </div>
</div>

<!-- PLATFORM COMPARISON -->
<div class="platform-grid">
  <!-- KALSHI CARD -->
  <div class="platform-card kalshi">
    <div class="platform-header">
      <div class="platform-name">
        <div class="platform-icon">üü¢</div>
        <div class="platform-label">
          <h2>KALSHI</h2>
          <div class="timeframe">15-Minute Markets</div>
        </div>
      </div>
    </div>
    <div class="platform-stats">
      <div class="stat-box">
        <div class="stat-value positive" id="kalshiWins">--</div>
        <div class="stat-label">Wins</div>
      </div>
      <div class="stat-box">
        <div class="stat-value negative" id="kalshiLosses">--</div>
        <div class="stat-label">Losses</div>
      </div>
      <div class="stat-box">
        <div class="stat-value neutral" id="kalshiWLRatio">--</div>
        <div class="stat-label">W/L Ratio</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="kalshiPnL">$--</div>
        <div class="stat-label">Today's P&L</div>
      </div>
    </div>
  </div>

  <!-- POLYMARKET CARD -->
  <div class="platform-card polymarket">
    <div class="platform-header">
      <div class="platform-name">
        <div class="platform-icon">üîµ</div>
        <div class="platform-label">
          <h2>POLYMARKET</h2>
          <div class="timeframe">5-Minute Markets</div>
        </div>
      </div>
    </div>
    <div class="platform-stats">
      <div class="stat-box">
        <div class="stat-value positive" id="polyWins">--</div>
        <div class="stat-label">Wins</div>
      </div>
      <div class="stat-box">
        <div class="stat-value negative" id="polyLosses">--</div>
        <div class="stat-label">Losses</div>
      </div>
      <div class="stat-box">
        <div class="stat-value neutral" id="polyWLRatio">--</div>
        <div class="stat-label">W/L Ratio</div>
      </div>
      <div class="stat-box">
        <div class="stat-value neutral" id="polyPnL">$--</div>
        <div class="stat-label">Unredeemed P&L</div>
      </div>
    </div>
  </div>
</div>

<!-- ACTIVE POSITIONS (My Addition) -->
<div class="active-positions">
  <div class="section-header">
    <h3>üìç ACTIVE POSITIONS</h3>
    <div class="position-count" id="positionCount">0 Open</div>
  </div>
  <div class="positions-list" id="positionsList">
    <div class="no-positions">No active positions</div>
  </div>
</div>

<!-- CORRELATION MATRIX -->
<div class="correlation-section">
  <div class="section-header">
    <h3>üîó CROSS-PLATFORM CORRELATION</h3>
  </div>
  <div class="correlation-grid">
    <div class="corr-item">
      <div class="corr-value high" id="corr5to15">--%</div>
      <div class="corr-label">5m ‚Üí 15m BTC</div>
    </div>
    <div class="corr-item">
      <div class="corr-value medium" id="corrBtcSol">--%</div>
      <div class="corr-label">BTC ‚Üî SOL</div>
    </div>
    <div class="corr-item">
      <div class="corr-value low" id="corrPlatforms">--%</div>
      <div class="corr-label">Kalshi ‚Üî Poly</div>
    </div>
    <div class="corr-item">
      <div class="corr-value high" id="corrAdx">--%</div>
      <div class="corr-label">ADX &gt;50 Win</div>
    </div>
  </div>
</div>

<!-- RECENT RESOLUTIONS -->
<div class="recent-section">
  <div class="section-header">
    <h3>üìä RECENT RESOLUTIONS</h3>
  </div>
  <div class="resolutions-list" id="resolutionsList">
    <div class="loading">
      <div class="spinner"></div>
      Loading trades...
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer class="footer">
  <p>Last updated: <span class="refresh-time" id="lastUpdate">--</span></p>
  <p>Powered by <a href="https://predictwithoshi.com">Oshi Overseer</a> | Auto-refresh: 60s</p>
</footer>

<script>
const API_BASE = '';
const POLY_API = '/poly-api';

// Format currency
const fmt = (n) => {
  if (n === null || n === undefined) return '$--';
  const sign = n >= 0 ? '+' : '';
  return `${sign}$${Math.abs(n).toFixed(2)}`;
};

// Format percentage
const pct = (n) => {
  if (n === null || n === undefined) return '--%';
  return `${Math.round(n)}%`;
};

// Update Kalshi stats
const updateKalshi = async () => {
  try {
    const res = await fetch(`${API_BASE}/api/today`);
    if (!res.ok) throw new Error('Kalshi API error');
    const data = await res.json();
    
    const wins = data.stats?.wins || 0;
    const losses = data.stats?.losses || 0;
    const pnl = data.stats?.pnl || 0;
    const ratio = losses > 0 ? (wins / losses).toFixed(2) : wins > 0 ? '‚àû' : '0';
    
    document.getElementById('kalshiWins').textContent = wins;
    document.getElementById('kalshiLosses').textContent = losses;
    document.getElementById('kalshiWLRatio').textContent = ratio;
    
    const pnlEl = document.getElementById('kalshiPnL');
    pnlEl.textContent = fmt(pnl);
    pnlEl.className = `stat-value ${pnl >= 0 ? 'positive' : 'negative'}`;
    
    // Balance
    const balRes = await fetch(`${API_BASE}/api/balance`);
    if (balRes.ok) {
      const balData = await balRes.json();
      document.getElementById('kalshiBalance').textContent = `$${(balData.balance / 100).toFixed(2)}`;
    }
  } catch (e) {
    console.error('Kalshi fetch error:', e);
  }
};

// Update Polymarket stats
const updatePolymarket = async () => {
  try {
    const res = await fetch(`${POLY_API}/stats`);
    if (!res.ok) throw new Error('Poly API error');
    const data = await res.json();
    
    const wins = data.wins || 0;
    const losses = data.losses || 0;
    const pnl = data.unredeemed_pnl || data.total_pnl || 0;
    const ratio = losses > 0 ? (wins / losses).toFixed(2) : wins > 0 ? '‚àû' : '0';
    
    document.getElementById('polyWins').textContent = wins;
    document.getElementById('polyLosses').textContent = losses;
    document.getElementById('polyWLRatio').textContent = ratio;
    
    const pnlEl = document.getElementById('polyPnL');
    pnlEl.textContent = fmt(pnl);
    pnlEl.className = `stat-value ${pnl >= 0 ? 'positive' : 'negative'}`;
    
    // Balance
    if (data.balance) {
      document.getElementById('polyBalance').textContent = `$${data.balance.toFixed(2)}`;
    }
  } catch (e) {
    console.error('Poly fetch error:', e);
  }
};

// Update active positions
const updatePositions = async () => {
  try {
    const container = document.getElementById('positionsList');
    const countEl = document.getElementById('positionCount');
    
    // Fetch from both platforms
    let positions = [];
    
    // Kalshi positions
    try {
      const kRes = await fetch(`${API_BASE}/api/positions`);
      if (kRes.ok) {
        const kData = await kRes.json();
        positions = positions.concat((kData.positions || []).map(p => ({
          ...p,
          platform: 'kalshi',
          icon: 'üü¢'
        })));
      }
    } catch (e) {}
    
    // Poly positions
    try {
      const pRes = await fetch(`${POLY_API}/positions`);
      if (pRes.ok) {
        const pData = await pRes.json();
        positions = positions.concat((pData.positions || []).map(p => ({
          ...p,
          platform: 'polymarket',
          icon: 'üîµ'
        })));
      }
    } catch (e) {}
    
    countEl.textContent = `${positions.length} Open`;
    
    if (positions.length === 0) {
      container.innerHTML = '<div class="no-positions">No active positions</div>';
      return;
    }
    
    container.innerHTML = positions.map(p => {
      const pnlClass = (p.pnl_pct || 0) >= 0 ? 'positive' : 'negative';
      const alert = (p.pnl_pct || 0) <= -25 ? '<span class="position-alert">‚ö°-25% CHECK</span>' : '';
      
      return `
        <div class="position-item ${p.platform}">
          <span class="position-platform">${p.icon}</span>
          <div class="position-info">
            <div class="position-market">${p.asset || p.ticker} ${p.direction || p.side?.toUpperCase()}</div>
            <div class="position-meta">Entry: ${p.entry_price}¬¢ ‚Üí ${p.current_price || '?'}¬¢</div>
          </div>
          <span class="position-pnl ${pnlClass}">${(p.pnl_pct || 0).toFixed(1)}%</span>
          ${alert}
        </div>
      `;
    }).join('');
  } catch (e) {
    console.error('Positions fetch error:', e);
  }
};

// Update recent resolutions
const updateResolutions = async () => {
  try {
    const container = document.getElementById('resolutionsList');
    let trades = [];
    
    // Fetch Kalshi trades
    try {
      const kRes = await fetch(`${API_BASE}/api/trades`);
      if (kRes.ok) {
        const kData = await kRes.json();
        trades = trades.concat((kData.trades || []).slice(0, 10).map(t => ({
          ...t,
          platform: 'kalshi',
          icon: 'üü¢'
        })));
      }
    } catch (e) {}
    
    // Fetch Poly trades
    try {
      const pRes = await fetch(`${POLY_API}/trades`);
      if (pRes.ok) {
        const pData = await pRes.json();
        trades = trades.concat((pData.trades || []).slice(0, 10).map(t => ({
          ...t,
          platform: 'polymarket',
          icon: 'üîµ'
        })));
      }
    } catch (e) {}
    
    // Sort by timestamp descending and take last 5
    trades.sort((a, b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0));
    trades = trades.slice(0, 5);
    
    if (trades.length === 0) {
      container.innerHTML = '<div class="no-positions">No recent trades</div>';
      return;
    }
    
    container.innerHTML = trades.map(t => {
      const won = t.won === true || t.pnl > 0 || t.pnl_usd > 0;
      const pnl = t.pnl || t.pnl_usd || 0;
      const pnlClass = pnl >= 0 ? 'positive' : 'negative';
      const outcome = won ? 'win' : 'loss';
      const market = t.asset || t.ticker?.split('-')[0] || '?';
      const side = t.direction || t.side?.toUpperCase() || '?';
      const time = t.timestamp ? new Date(t.timestamp).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'}) : '?';
      
      return `
        <div class="resolution-item">
          <span class="resolution-platform">${t.icon}</span>
          <div class="resolution-info">
            <div class="resolution-market">${market} ${side}</div>
            <div class="resolution-meta">${t.platform} ‚Ä¢ ${time}</div>
          </div>
          <span class="resolution-outcome ${outcome}">${won ? 'WIN' : 'LOSS'}</span>
          <span class="resolution-pnl ${pnlClass}">${fmt(pnl)}</span>
        </div>
      `;
    }).join('');
  } catch (e) {
    console.error('Resolutions fetch error:', e);
  }
};

// Update correlations (placeholder - would need backend)
const updateCorrelations = () => {
  // These would come from an API - using placeholders
  document.getElementById('corr5to15').textContent = '67%';
  document.getElementById('corrBtcSol').textContent = '71%';
  document.getElementById('corrPlatforms').textContent = '45%';
  document.getElementById('corrAdx').textContent = '82%';
};

// Update timestamp
const updateTimestamp = () => {
  document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
};

// Main update function
const updateAll = async () => {
  await Promise.all([
    updateKalshi(),
    updatePolymarket(),
    updatePositions(),
    updateResolutions()
  ]);
  updateCorrelations();
  updateTimestamp();
};

// Initial load and refresh
updateAll();
setInterval(updateAll, 60000); // Refresh every 60s
</script>

</body>
</html>
