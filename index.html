<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="OSHI">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#00e5c3">
<meta name="msapplication-TileColor" content="#060918">
<meta name="application-name" content="OSHI">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<title>OSHI ‚Äî Kalshi Prediction Trader</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --oshi-teal: #00e5c3;
  --oshi-green: #39ff14;
  --oshi-navy: #0a0e27;
  --oshi-deep: #060918;
  --oshi-blue: #1a3a6b;
  --oshi-mid: #121a3a;
  --oshi-card: rgba(16, 22, 58, 0.85);
  --oshi-border: rgba(0, 229, 195, 0.15);
  --oshi-glow: rgba(0, 229, 195, 0.4);
  --profit: #39ff14;
  --loss: #ff3b5c;
  --gold: #ffd700;
  --text-primary: #e8edf5;
  --text-secondary: #8892b0;
  --text-dim: #4a5578;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--oshi-deep);
  color: var(--text-primary);
  font-family: 'Rajdhani', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

/* === ANIMATED BACKGROUND === */
.bg-grid {
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image:
    linear-gradient(rgba(0,229,195,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,229,195,0.03) 1px, transparent 1px);
  background-size: 40px 40px;
  animation: gridScroll 20s linear infinite;
}
@keyframes gridScroll {
  0% { background-position: 0 0; }
  100% { background-position: 40px 40px; }
}

.bg-orbs {
  position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden;
}
.bg-orbs::before, .bg-orbs::after {
  content: ''; position: absolute; border-radius: 50%; filter: blur(120px); opacity: 0.15;
}
.bg-orbs::before {
  width: 600px; height: 600px; background: var(--oshi-teal); top: -200px; right: -100px;
  animation: orbFloat 12s ease-in-out infinite;
}
.bg-orbs::after {
  width: 500px; height: 500px; background: #6366f1; bottom: -150px; left: -100px;
  animation: orbFloat 15s ease-in-out infinite reverse;
}
@keyframes orbFloat {
  0%, 100% { transform: translate(0, 0) scale(1); }
  50% { transform: translate(40px, -30px) scale(1.1); }
}

/* === HEADER === */
.header {
  position: relative; z-index: 10;
  display: flex; align-items: center; justify-content: space-between;
  padding: 16px 32px;
  background: linear-gradient(180deg, rgba(10,14,39,0.98) 0%, rgba(10,14,39,0.85) 100%);
  border-bottom: 1px solid var(--oshi-border);
  backdrop-filter: blur(20px);
}

.header-left {
  display: flex; align-items: center; gap: 16px;
}

.oshi-avatar {
  width: 52px; height: 52px; border-radius: 50%;
  border: 2px solid var(--oshi-teal);
  box-shadow: 0 0 20px var(--oshi-glow), inset 0 0 10px rgba(0,229,195,0.1);
  object-fit: cover; object-position: center 5%;
  animation: avatarPulse 3s ease-in-out infinite;
}
@keyframes avatarPulse {
  0%, 100% { box-shadow: 0 0 20px var(--oshi-glow); }
  50% { box-shadow: 0 0 35px var(--oshi-glow), 0 0 60px rgba(0,229,195,0.15); }
}

.header-title {
  display: flex; flex-direction: column;
}
.header-title h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px; font-weight: 800;
  background: linear-gradient(135deg, var(--oshi-teal), var(--oshi-green));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  letter-spacing: 3px;
}
.header-title span {
  font-size: 11px; color: var(--text-secondary);
  letter-spacing: 4px; text-transform: uppercase; font-weight: 500;
}

.header-right {
  display: flex; align-items: center; gap: 24px;
}

.market-badge {
  display: flex; align-items: center; gap: 8px;
  padding: 6px 16px; border-radius: 20px;
  background: rgba(0,229,195,0.08);
  border: 1px solid rgba(0,229,195,0.2);
  font-family: 'Orbitron', sans-serif;
  font-size: 11px; font-weight: 600;
  color: var(--oshi-teal); letter-spacing: 2px;
  text-decoration: none;
  transition: all 0.3s ease;
}
.market-badge:hover {
  background: rgba(0,229,195,0.15);
  border-color: var(--oshi-teal);
  box-shadow: 0 0 16px rgba(0,229,195,0.2);
  transform: translateY(-1px);
}

.oshi-x-link {
  display: flex; align-items: center; gap: 8px;
  padding: 8px 18px; border-radius: 20px;
  background: linear-gradient(135deg, rgba(0,229,195,0.15), rgba(57,255,20,0.08));
  border: 1px solid rgba(0,229,195,0.35);
  font-family: 'Orbitron', sans-serif;
  font-size: 12px; font-weight: 700;
  color: var(--oshi-teal); letter-spacing: 1.5px;
  text-decoration: none;
  transition: all 0.3s ease;
  box-shadow: 0 0 12px rgba(0,229,195,0.1);
}
.oshi-x-link:hover {
  background: linear-gradient(135deg, rgba(0,229,195,0.25), rgba(57,255,20,0.15));
  border-color: var(--oshi-teal);
  box-shadow: 0 0 24px rgba(0,229,195,0.25);
  transform: translateY(-1px);
}
.oshi-x-link svg { flex-shrink: 0; }

.footer-oshi-x {
  color: var(--oshi-teal) !important;
  font-weight: 600;
}
.market-badge .k-logo {
  width: 18px; height: 18px; background: var(--oshi-teal);
  border-radius: 4px; display: flex; align-items: center; justify-content: center;
  font-weight: 900; font-size: 12px; color: var(--oshi-navy);
}

.status-toggle {
  display: flex; align-items: center; gap: 10px;
  cursor: pointer; user-select: none;
}
.status-toggle .label {
  font-family: 'Orbitron', sans-serif; font-size: 11px;
  letter-spacing: 2px; font-weight: 600;
}
.toggle-track {
  width: 52px; height: 26px; border-radius: 13px;
  background: rgba(255,59,92,0.3); border: 1px solid rgba(255,59,92,0.5);
  position: relative; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}
.toggle-track.on {
  background: rgba(0,229,195,0.3); border-color: var(--oshi-teal);
}
.toggle-knob {
  width: 20px; height: 20px; border-radius: 50%;
  background: var(--loss); position: absolute;
  top: 2px; left: 3px; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  box-shadow: 0 0 10px rgba(255,59,92,0.5);
}
.toggle-track.on .toggle-knob {
  left: 28px; background: var(--oshi-teal);
  box-shadow: 0 0 15px var(--oshi-glow);
}

/* === MAIN LAYOUT === */
.dashboard {
  position: relative; z-index: 5;
  display: grid;
  grid-template-columns: 280px 1fr 1fr 1fr;
  grid-template-rows: auto auto auto auto;
  gap: 16px;
  padding: 20px 24px;
  max-width: 1600px; margin: 0 auto;
}
@media (max-width: 900px) {
  .dashboard {
    grid-template-columns: 1fr 1fr;
    padding: 16px;
  }
  .oshi-sidebar {
    grid-row: auto;
    grid-column: span 2;
  }
}
@media (max-width: 600px) {
  .dashboard {
    grid-template-columns: 1fr;
    gap: 12px;
    padding: 12px;
  }
  .oshi-sidebar {
    grid-column: span 1;
  }
  .card {
    grid-column: span 1 !important;
  }
}

/* === OSHI SIDEBAR === */
.oshi-sidebar {
  grid-row: 1 / -1;
  display: flex; flex-direction: column; gap: 16px;
}

.oshi-card {
  background: var(--oshi-card);
  border: 1px solid var(--oshi-border);
  border-radius: 16px;
  overflow: hidden;
  position: relative;
}

.oshi-portrait {
  position: relative;
  height: 320px; overflow: hidden;
}
.oshi-portrait img {
  width: 100%; height: 100%; object-fit: cover; object-position: center 5%;
  filter: saturate(1.1) contrast(1.05);
}
.oshi-portrait::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(0deg, var(--oshi-navy) 0%, transparent 50%);
}
.oshi-nameplate {
  position: absolute; bottom: 12px; left: 16px; right: 16px; z-index: 2;
}
.oshi-nameplate h2 {
  font-family: 'Orbitron', sans-serif;
  font-size: 28px; font-weight: 900;
  color: #fff; text-shadow: 0 0 30px var(--oshi-teal);
  letter-spacing: 4px;
}
.oshi-nameplate p {
  font-size: 11px; color: var(--oshi-teal);
  letter-spacing: 3px; text-transform: uppercase; font-weight: 600;
}

.oshi-stats {
  padding: 12px 16px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}
@media (max-width: 500px) {
  .oshi-stats {
    grid-template-columns: repeat(2, 1fr);
  }
}
.oshi-stat-row {
  display: flex; flex-direction: column; align-items: center;
  padding: 10px 8px; border-radius: 10px;
  background: rgba(0,229,195,0.06);
  border: 1px solid rgba(0,229,195,0.08);
  text-align: center;
}
.oshi-stat-row .stat-label {
  font-size: 9px; color: var(--text-secondary);
  text-transform: uppercase; letter-spacing: 1px; font-weight: 600;
  margin-bottom: 4px;
}
.oshi-stat-row .stat-value {
  font-family: 'Space Mono', monospace;
  font-size: 16px; font-weight: 700;
}

/* === CARDS === */
.card {
  background: var(--oshi-card);
  border: 1px solid var(--oshi-border);
  border-radius: 14px;
  backdrop-filter: blur(10px);
  overflow: hidden;
  animation: cardFadeIn 0.6s ease-out both;
}
.card:nth-child(2) { animation-delay: 0.05s; }
.card:nth-child(3) { animation-delay: 0.1s; }
.card:nth-child(4) { animation-delay: 0.15s; }
.card:nth-child(5) { animation-delay: 0.2s; }
.card:nth-child(6) { animation-delay: 0.25s; }

@keyframes cardFadeIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

.card-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 18px 10px;
  border-bottom: 1px solid rgba(0,229,195,0.06);
}
.card-header h3 {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px; font-weight: 700;
  letter-spacing: 2.5px; text-transform: uppercase;
  color: var(--oshi-teal);
}
.card-header .badge {
  font-family: 'Space Mono', monospace;
  font-size: 10px; padding: 3px 10px;
  border-radius: 10px; font-weight: 700;
  letter-spacing: 1px;
}
.badge-live {
  background: rgba(57,255,20,0.12); color: var(--profit);
  border: 1px solid rgba(57,255,20,0.25);
  animation: livePulse 2s ease-in-out infinite;
}
@keyframes livePulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}
.badge-session { background: rgba(0,229,195,0.1); color: var(--oshi-teal); border: 1px solid rgba(0,229,195,0.2); }
.badge-all { background: rgba(99,102,241,0.15); color: #818cf8; border: 1px solid rgba(99,102,241,0.25); }

.card-body { padding: 12px 16px 16px; }

/* === CURRENT POSITIONS === */
.positions-section {
  grid-column: 2 / 5;
  margin-bottom: 16px;
}
.positions-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.no-positions {
  color: var(--text-secondary);
  font-style: italic;
  text-align: center;
  padding: 20px;
}
.position-item {
  display: grid;
  grid-template-columns: 80px 60px 1fr 80px 80px 90px;
  gap: 12px;
  align-items: center;
  padding: 12px 16px;
  background: rgba(0, 229, 195, 0.05);
  border: 1px solid var(--oshi-border);
  border-radius: 8px;
  font-family: 'Space Mono', monospace;
  font-size: 13px;
}
@media (max-width: 768px) {
  .position-item {
    display: grid;
    grid-template-columns: auto auto 1fr auto;
    gap: 6px 12px;
    padding: 14px;
    font-size: 13px;
  }
  .position-asset { 
    font-size: 15px;
    font-weight: 700;
  }
  .position-side { 
    font-size: 11px; 
    padding: 3px 10px; 
  }
  .position-entry { 
    text-align: right;
    white-space: nowrap;
  }
  .position-pnl { 
    font-size: 16px;
    font-weight: 700;
    text-align: right;
    grid-row: 1 / 3;
    grid-column: 4;
    align-self: center;
  }
  .position-current { 
    grid-column: 1 / 3;
    font-size: 12px;
    opacity: 0.7;
  }
  .position-size { 
    grid-column: 3;
    font-size: 12px;
    text-align: right;
    opacity: 0.7;
  }
}
.position-item:hover {
  background: rgba(0, 229, 195, 0.1);
  border-color: var(--oshi-teal);
}
.position-asset {
  font-weight: 700;
  color: var(--oshi-teal);
}
.position-side {
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
}
.position-side.yes { background: rgba(57,255,20,0.15); color: var(--profit); }
.position-side.no { background: rgba(255,59,92,0.15); color: var(--loss); }
.position-entry, .position-current, .position-size {
  color: var(--text-secondary);
}
.position-pnl {
  font-weight: 700;
  text-align: right;
}
.position-pnl.positive { color: var(--profit); }
.position-pnl.negative { color: var(--loss); }
#positionsBadge {
  background: rgba(0,229,195,0.15);
  color: var(--oshi-teal);
}
#positionsBadge.has-positions {
  background: rgba(57,255,20,0.2);
  color: var(--profit);
  animation: pulse 2s ease-in-out infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

/* === PNL HERO CARDS === */
.pnl-row {
  grid-column: 2 / 5;
  display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;
}

.pnl-hero {
  background: var(--oshi-card);
  border: 1px solid var(--oshi-border);
  border-radius: 14px;
  padding: 20px 24px;
  position: relative; overflow: hidden;
}
.pnl-hero::before {
  content: ''; position: absolute; inset: 0;
  opacity: 0.04;
}
.pnl-hero.session::before { background: linear-gradient(135deg, var(--oshi-teal), transparent); }
.pnl-hero.wallet::before { background: linear-gradient(135deg, #6366f1, transparent); }
.pnl-hero.balance::before { background: linear-gradient(135deg, var(--gold), transparent); }
.pnl-value.balance-val { color: #ffffff; text-shadow: 0 0 20px rgba(255,255,255,0.15); }

.pnl-label {
  font-family: 'Orbitron', sans-serif;
  font-size: 10px; letter-spacing: 3px; text-transform: uppercase;
  color: var(--text-secondary); font-weight: 600; margin-bottom: 6px;
}
.pnl-value {
  font-family: 'Orbitron', sans-serif;
  font-size: 36px; font-weight: 900;
  line-height: 1.1;
}
.pnl-value.positive { color: var(--profit); text-shadow: 0 0 30px rgba(57,255,20,0.3); }
.pnl-value.negative { color: var(--loss); text-shadow: 0 0 30px rgba(255,59,92,0.3); }
.pnl-pct {
  font-family: 'Space Mono', monospace;
  font-size: 14px; font-weight: 700; margin-top: 4px;
}
.pnl-pct.positive { color: var(--profit); }
.pnl-pct.negative { color: var(--loss); }

/* === TRADE TABLES === */
.trade-list { list-style: none; display: flex; flex-direction: column; gap: 6px; }
.trade-item {
  display: grid; grid-template-columns: 1fr auto auto auto;
  gap: 12px; align-items: center;
  padding: 8px 12px; border-radius: 8px;
  background: rgba(0,229,195,0.02);
  border: 1px solid rgba(0,229,195,0.04);
  transition: all 0.2s;
  font-size: 13px;
}
.trade-item:hover {
  background: rgba(0,229,195,0.06);
  border-color: rgba(0,229,195,0.12);
  transform: translateX(3px);
}
.trade-name {
  font-weight: 600; color: var(--text-primary);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.trade-result {
  font-family: 'Space Mono', monospace; font-size: 11px;
  padding: 2px 8px; border-radius: 6px; font-weight: 700;
}
.trade-result.win { background: rgba(57,255,20,0.1); color: var(--profit); }
.trade-result.loss { background: rgba(255,59,92,0.1); color: var(--loss); }
.trade-pnl {
  font-family: 'Space Mono', monospace; font-size: 12px; font-weight: 700;
  text-align: right; min-width: 70px;
}
.trade-pnl.positive { color: var(--profit); }
.trade-pnl.negative { color: var(--loss); }
.trade-pct {
  font-family: 'Space Mono', monospace; font-size: 11px;
  color: var(--text-secondary); min-width: 50px; text-align: right;
}

/* === RANK NUMBER === */
.rank {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px; font-weight: 800;
  min-width: 22px; height: 22px;
  display: flex; align-items: center; justify-content: center;
  border-radius: 6px; margin-right: 4px;
}
.rank.gold { background: rgba(255,215,0,0.15); color: var(--gold); }
.rank.silver { background: rgba(192,192,192,0.12); color: #c0c0c0; }
.rank.bronze { background: rgba(205,127,50,0.12); color: #cd7f32; }
.rank.normal { background: rgba(0,229,195,0.06); color: var(--text-dim); }

.leader-item {
  display: grid; grid-template-columns: 28px 1fr auto auto;
  gap: 8px; align-items: center;
  padding: 7px 10px; border-radius: 8px;
  background: rgba(0,229,195,0.02);
  border: 1px solid rgba(0,229,195,0.04);
  transition: all 0.2s;
}
.leader-item:hover {
  background: rgba(0,229,195,0.06);
  transform: translateX(3px);
}

/* === LESSONS CARD === */
.lesson-list { list-style: none; display: flex; flex-direction: column; gap: 8px; }
.lesson-item {
  padding: 10px 14px; border-radius: 10px;
  border-left: 3px solid var(--oshi-teal);
  background: rgba(0,229,195,0.03);
  font-size: 13px; line-height: 1.5;
  color: var(--text-secondary);
  transition: all 0.2s;
}
.lesson-item:hover {
  background: rgba(0,229,195,0.07);
  color: var(--text-primary);
}
.lesson-item.impl { border-left-color: #6366f1; background: rgba(99,102,241,0.04); }
.lesson-item.impl:hover { background: rgba(99,102,241,0.08); }
.lesson-item.manual { border-left-color: var(--gold); background: rgba(255,215,0,0.03); }
.lesson-item.manual:hover { background: rgba(255,215,0,0.07); }
.lesson-time {
  font-family: 'Space Mono', monospace;
  font-size: 10px; color: var(--text-dim);

}

/* === BRAIN ACTIVITY === */
.brain-section {
  grid-column: 1 / -1;
  margin-top: 8px;
}
.brain-section-header {
  display: flex; align-items: center; gap: 14px;
  margin-bottom: 16px;
  padding: 0 4px;
}
.brain-section-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 14px; font-weight: 700;
  letter-spacing: 3px; text-transform: uppercase;
  color: var(--oshi-teal);
}
.brain-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
}

.brain-card {
  background: var(--oshi-card);
  border: 1px solid var(--oshi-border);
  border-radius: 14px;
  overflow: hidden;
  position: relative;
}
.brain-card::before {
  content: ''; position: absolute; inset: 0; opacity: 0.03; pointer-events: none;
}
.brain-card.left-brain { border-left: 3px solid #00b4d8; }
.brain-card.left-brain::before { background: linear-gradient(135deg, #00b4d8, transparent); }
.brain-card.right-brain { border-left: 3px solid #f472b6; }
.brain-card.right-brain::before { background: linear-gradient(135deg, #f472b6, transparent); }

.brain-card-header {
  display: flex; align-items: center; gap: 12px;
  padding: 14px 18px;
  border-bottom: 1px solid rgba(0,229,195,0.06);
}
.brain-icon {
  width: 34px; height: 34px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Orbitron', sans-serif; font-size: 14px; font-weight: 900;
  flex-shrink: 0;
}
.brain-icon.left { background: rgba(0,180,216,0.15); color: #00b4d8; }
.brain-icon.right { background: rgba(244,114,182,0.15); color: #f472b6; }

.brain-label-group { flex: 1; }
.brain-name {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px; font-weight: 700; letter-spacing: 2px;
  text-transform: uppercase; color: var(--text-primary);
}
.brain-role {
  font-size: 11px; color: var(--text-dim); letter-spacing: 0.5px;
}

.brain-status {
  font-family: 'Space Mono', monospace;
  font-size: 9px; font-weight: 700; letter-spacing: 2px;
  padding: 4px 10px; border-radius: 8px;
  background: rgba(0,229,195,0.08); color: var(--oshi-teal);
  border: 1px solid rgba(0,229,195,0.15);
  animation: livePulse 2s ease-in-out infinite;
}

.brain-thought-stream {
  padding: 12px 18px 16px;
  display: flex; flex-direction: column; gap: 12px;
  max-height: 420px; overflow-y: auto;
}

.thought-entry {
  padding: 12px 14px;
  border-radius: 10px;
  background: rgba(0,0,0,0.2);
  border: 1px solid rgba(255,255,255,0.04);
  position: relative;
  transition: all 0.2s;
}
.thought-entry:hover {
  background: rgba(0,0,0,0.3);
  border-color: rgba(255,255,255,0.08);
}
.thought-entry:first-child {
  border-color: rgba(0,229,195,0.15);
  background: rgba(0,229,195,0.03);
}

.thought-time {
  font-family: 'Space Mono', monospace;
  font-size: 10px; color: var(--text-dim);
  display: block; margin-bottom: 6px;
}

.thought-action {
  font-family: 'Space Mono', monospace;
  font-size: 10px; font-weight: 700; letter-spacing: 1.5px;
  padding: 2px 10px; border-radius: 6px;
  position: absolute; top: 12px; right: 14px;
}
.thought-action.buy { background: rgba(57,255,20,0.12); color: var(--profit); }
.thought-action.sell { background: rgba(255,165,0,0.15); color: #ffa500; }
.thought-action.skip { background: rgba(136,146,176,0.12); color: var(--text-secondary); }

.thought-text {
  font-size: 13px; line-height: 1.6; color: var(--text-secondary);
  padding-right: 60px;
}
.thought-text strong { color: var(--text-primary); font-weight: 600; }
.thought-text em {
  color: var(--oshi-teal); font-style: normal; font-weight: 600;
  display: block; margin-top: 4px;
}
  margin-bottom: 4px; display: block;
}

/* === LEADERBOARD SECTION GRID === */
.boards-grid {
  grid-column: 2 / 5;
  display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
}

.boards-section-title {
  grid-column: 1 / -1;
  font-family: 'Orbitron', sans-serif;
  font-size: 10px; letter-spacing: 3px;
  color: var(--text-dim); text-transform: uppercase;
  padding: 8px 0 0 4px;
}

/* === LEADERBOARD TABBED INTERFACE === */
.leaderboard-container {
  grid-column: 2 / 5;
  display: grid;
}

.leaderboard-tabs {
  display: flex;
  gap: 8px;
}

.lb-tab {
  background: transparent;
  border: 1px solid var(--oshi-border);
  color: var(--text-secondary);
  padding: 6px 16px;
  border-radius: 20px;
  font-family: 'Rajdhani', sans-serif;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.lb-tab:hover {
  border-color: var(--oshi-teal);
  color: var(--oshi-teal);
}

.lb-tab.active {
  background: linear-gradient(135deg, rgba(0,229,195,0.15), rgba(57,255,20,0.1));
  border-color: var(--oshi-teal);
  color: var(--oshi-teal);
  box-shadow: 0 0 12px rgba(0,229,195,0.2);
}

.lb-content {
  display: none;
}

.lb-content.active {
  display: block;
}

.lb-split {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 0;
  align-items: start;
}

.lb-divider {
  width: 1px;
  background: linear-gradient(to bottom, transparent, var(--oshi-border), transparent);
  margin: 0 20px;
  min-height: 150px;
  align-self: stretch;
}

.lb-column {
  padding: 8px 0;
}

.lb-column-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 0 12px 0;
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.lb-winners .lb-column-header {
  color: var(--profit);
}

.lb-losers .lb-column-header {
  color: var(--loss);
}

.lb-icon {
  font-size: 16px;
}

.trade-list.compact {
  gap: 6px;
}

.trade-list.compact .leader-item {
  padding: 8px 12px;
  font-size: 13px;
}

.trade-list.compact .trade-name {
  font-size: 12px;
}

.trade-list.compact .trade-pct,
.trade-list.compact .trade-pnl {
  font-size: 12px;
}

.rank.loss {
  background: rgba(255,59,92,0.12);
  color: var(--loss);
}

/* === RECENT TRADES FULL WIDTH === */
.recent-trades {
  grid-column: 2 / 5;
}

/* === LESSONS ROW === */
.lessons-row {
  grid-column: 2 / 5;
  display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;
}

/* === FOOTER === */
.footer {
  position: relative; z-index: 10;
  text-align: center; padding: 20px;
  border-top: 1px solid var(--oshi-border);
  margin-top: 8px;
}
.footer span {
  font-family: 'Orbitron', sans-serif;
  font-size: 10px; letter-spacing: 3px;
  color: var(--text-dim);
}
.footer a {
  color: var(--oshi-teal); text-decoration: none;
}

/* === SCROLLBAR === */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--oshi-deep); }
::-webkit-scrollbar-thumb { background: rgba(0,229,195,0.2); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: rgba(0,229,195,0.4); }

/* === SCAN LINE EFFECT === */
.scanline {
  position: fixed; top: 0; left: 0; right: 0; height: 2px; z-index: 100;
  background: linear-gradient(90deg, transparent, var(--oshi-teal), transparent);
  opacity: 0.4;
  animation: scanDown 4s linear infinite;
  pointer-events: none;
}
@keyframes scanDown {
  0% { top: -2px; }
  100% { top: 100vh; }
}

/* === RESPONSIVE === */
@media (max-width: 1200px) {
  .dashboard {
    grid-template-columns: 1fr 1fr;
  }
  .oshi-sidebar { grid-row: auto; grid-column: 1 / -1; }
  .oshi-sidebar { flex-direction: row; }
  .oshi-portrait { height: 200px; min-width: 200px; }
  .pnl-row, .recent-trades, .boards-grid, .lessons-row { grid-column: 1 / -1; }
  .lessons-row { grid-template-columns: 1fr; }
}
@media (max-width: 768px) {
  .header { 
    padding: 12px 16px; 
    padding-top: calc(12px + env(safe-area-inset-top, 0px));
    flex-wrap: wrap; 
    gap: 12px; 
  }
  .dashboard { 
    display: flex !important;
    flex-direction: column !important;
    padding: 12px; 
    padding-bottom: calc(12px + env(safe-area-inset-bottom, 20px));
    gap: 14px; 
  }
  .oshi-sidebar {
    order: 1;
    width: 100%;
  }
  .positions-container { order: 2; }
  .pnl-row { 
    order: 3;
    display: flex !important;
    flex-direction: column !important;
    gap: 12px;
  }
  .recent-trades { order: 4; }
  .boards-grid { 
    order: 5;
    display: flex !important;
    flex-direction: column !important;
    gap: 12px;
  }
  .lessons-row { order: 6; }
  
  .leaderboard-container { width: 100%; }
  .lb-split { grid-template-columns: 1fr; gap: 16px; }
  .lb-divider { display: none; }
  .lb-column { border-bottom: 1px solid var(--oshi-border); padding-bottom: 16px; }
  .lb-column:last-child { border-bottom: none; }
  .leaderboard-tabs { justify-content: center; }
  .oshi-sidebar { flex-direction: column; }
  .oshi-portrait { height: 200px; min-width: auto; }
  .pnl-value { font-size: 32px; }
  .card { padding: 16px; }
  .card-title { font-size: 13px; }
  .stat-value { font-size: 22px; }
  .header-title { font-size: 20px; }
  .subtitle { font-size: 10px; }
  
  /* Hide particles on mobile for performance */
  #particles { display: none; }
  .bg-orbs::before, .bg-orbs::after { filter: blur(80px); opacity: 0.1; }
}

/* Extra small screens */
@media (max-width: 380px) {
  .header { padding: 8px 12px; padding-top: calc(8px + env(safe-area-inset-top, 0px)); }
  .dashboard { padding: 8px; gap: 8px; }
  .card { padding: 12px; }
  .pnl-value { font-size: 24px; }
  .stat-value { font-size: 18px; }
}

/* Particle canvas */
#particles { position: fixed; inset: 0; z-index: 1; pointer-events: none; }
</style>
</head>
<body>

<div class="bg-grid"></div>
<div class="bg-orbs"></div>
<div class="scanline"></div>
<canvas id="particles"></canvas>

<!-- HEADER -->
<header class="header">
  <div class="header-left">
    <img src="oshi-avatar.png" alt="Oshi" class="oshi-avatar" id="oshiAvatar">
    <div class="header-title">
      <h1>OSHI</h1>
      <span>Kalshi Prediction Trader</span>
    </div>
  </div>
  <div class="header-right">
    <a href="https://x.com/PredictwithOshi" target="_blank" class="oshi-x-link">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      <span>@PredictwithOshi</span>
    </a>
    <a href="https://kalshi.com/sign-up/?referral=3284dc15-89f1-494b-ac60-b0d124d26b1d" target="_blank" class="market-badge">
      <div class="k-logo">K</div>
      TRADE WITH OSHI
    </a>
    <div class="status-toggle" id="statusToggle" onclick="toggleStatus()">
      <span class="label" id="statusLabel" style="color: var(--loss);">OFFLINE</span>
      <div class="toggle-track" id="toggleTrack">
        <div class="toggle-knob"></div>
      </div>
    </div>
  </div>
</header>

<!-- DASHBOARD -->
<main class="dashboard">

  <!-- OSHI SIDEBAR -->
  <aside class="oshi-sidebar">
    <div class="oshi-card">
      <div class="oshi-portrait">
        <img src="oshi-new.png" alt="Oshi - Kalshi Prediction Agent" id="oshiPortrait">
        <div class="oshi-nameplate">
          <h2>OSHI</h2>
          <p>Prediction Agent v1.0</p>
        </div>
      </div>
      <div class="oshi-stats">
        <div class="oshi-stat-row">
          <span class="stat-label">Win Rate</span>
          <span class="stat-value" style="color: var(--profit);" id="winRate">68.4%</span>
        </div>
        <div class="oshi-stat-row">
          <span class="stat-label">Trades Today</span>
          <span class="stat-value" style="color: var(--oshi-teal);" id="tradesToday">24</span>
        </div>
        <div class="oshi-stat-row">
          <span class="stat-label">Avg Return</span>
          <span class="stat-value" style="color: var(--profit);" id="avgReturn">+12.3%</span>
        </div>
        <div class="oshi-stat-row">
          <span class="stat-label">Active Pos.</span>
          <span class="stat-value" style="color: var(--oshi-teal);" id="activePos">3</span>
        </div>
        <div class="oshi-stat-row">
          <span class="stat-label">Streak</span>
          <span class="stat-value" style="color: var(--gold);" id="streak">üî• 5W</span>
        </div>
        <div class="oshi-stat-row">
          <span class="stat-label">Uptime</span>
          <span class="stat-value" style="color: var(--text-secondary);" id="uptime">4h 23m</span>
        </div>
      </div>
    </div>
  </aside>

  <!-- CURRENT POSITIONS -->
  <div class="positions-section card" id="positionsSection">
    <div class="card-header">
      <h3>üìä Current Positions</h3>
      <span class="badge" id="positionsBadge">0 OPEN</span>
    </div>
    <div class="card-body">
      <div id="positionsList" class="positions-list">
        <div class="no-positions">No current positions</div>
      </div>
    </div>
  </div>

  <!-- PNL HERO ROW -->
  <div class="pnl-row">
    <div class="pnl-hero balance">
      <div class="pnl-label">Starting Balance</div>
      <div class="pnl-value balance-val">$192.00</div>
      <div class="pnl-pct" style="color: var(--text-secondary);">Two-Brain v2 Baseline</div>
    </div>
    <div class="pnl-hero session">
      <div class="pnl-label">Current Balance</div>
      <div class="pnl-value balance-val" id="currentBalance">$192.00</div>
      <div class="pnl-pct" style="color: var(--text-secondary);">Kalshi ¬∑ USD</div>
    </div>
    <div class="pnl-hero wallet">
      <div class="pnl-label">P&L</div>
      <div class="pnl-value" id="totalPnl">$0.00</div>
      <div class="pnl-pct" id="pnlPct">0.0%</div>
    </div>
  </div>

  <!-- RECENT TRADES -->
  <div class="recent-trades card">
    <div class="card-header">
      <h3>Recent Trades</h3>
      <span class="badge badge-live">‚óè LIVE</span>
    </div>
    <div class="card-body">
      <ul class="trade-list" id="recentTrades">
        <li class="trade-item">
          <span class="trade-name">BTC above $105K by Feb 14</span>
          <span class="trade-result win">WIN</span>
          <span class="trade-pct">+22.5%</span>
          <span class="trade-pnl positive">+$45.00</span>
        </li>
        <li class="trade-item">
          <span class="trade-name">Fed rate hold March meeting</span>
          <span class="trade-result win">WIN</span>
          <span class="trade-pct">+15.0%</span>
          <span class="trade-pnl positive">+$30.00</span>
        </li>
        <li class="trade-item">
          <span class="trade-name">S&P 500 closes green today</span>
          <span class="trade-result loss">LOSS</span>
          <span class="trade-pct">-8.3%</span>
          <span class="trade-pnl negative">-$16.60</span>
        </li>
        <li class="trade-item">
          <span class="trade-name">ETH above $3K by Feb 10</span>
          <span class="trade-result win">WIN</span>
          <span class="trade-pct">+31.2%</span>
          <span class="trade-pnl positive">+$62.40</span>
        </li>
        <li class="trade-item">
          <span class="trade-name">Trump executive order on crypto</span>
          <span class="trade-result win">WIN</span>
          <span class="trade-pct">+18.0%</span>
          <span class="trade-pnl positive">+$36.00</span>
        </li>
        <li class="trade-item">
          <span class="trade-name">CPI above 3.0% January</span>
          <span class="trade-result loss">LOSS</span>
          <span class="trade-pct">-12.5%</span>
          <span class="trade-pnl negative">-$25.00</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- LEADERBOARDS - Tabbed Interface -->
  <div class="leaderboard-container">
    <div class="card" style="grid-column: 1 / -1;">
      <div class="card-header" style="justify-content: space-between;">
        <h3>üìä Trade Leaderboards</h3>
        <div class="leaderboard-tabs">
          <button class="lb-tab active" data-tab="session" onclick="switchLeaderboardTab('session')">This Session</button>
          <button class="lb-tab" data-tab="alltime" onclick="switchLeaderboardTab('alltime')">All Time</button>
        </div>
      </div>
      <div class="card-body">
        <!-- Session Tab Content -->
        <div class="lb-content active" id="lb-session">
          <div class="lb-split">
            <div class="lb-column lb-winners">
              <div class="lb-column-header">
                <span class="lb-icon">üèÜ</span>
                <span>Best Trades</span>
              </div>
              <ul class="trade-list compact" id="sessionTop">
                <li class="leader-item"><span class="rank gold">1</span><span class="trade-name">Loading...</span></li>
              </ul>
            </div>
            <div class="lb-divider"></div>
            <div class="lb-column lb-losers">
              <div class="lb-column-header">
                <span class="lb-icon">üíÄ</span>
                <span>Worst Trades</span>
              </div>
              <ul class="trade-list compact" id="sessionWorst">
                <li class="leader-item"><span class="rank loss">1</span><span class="trade-name">Loading...</span></li>
              </ul>
            </div>
          </div>
        </div>
        <!-- All Time Tab Content -->
        <div class="lb-content" id="lb-alltime">
          <div class="lb-split">
            <div class="lb-column lb-winners">
              <div class="lb-column-header">
                <span class="lb-icon">üëë</span>
                <span>Best Trades</span>
              </div>
              <ul class="trade-list compact" id="allTimeTop">
                <li class="leader-item"><span class="rank gold">1</span><span class="trade-name">Loading...</span></li>
              </ul>
            </div>
            <div class="lb-divider"></div>
            <div class="lb-column lb-losers">
              <div class="lb-column-header">
                <span class="lb-icon">‚ò†Ô∏è</span>
                <span>Worst Trades</span>
              </div>
              <ul class="trade-list compact" id="allTimeWorst">
                <li class="leader-item"><span class="rank loss">1</span><span class="trade-name">Loading...</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- LESSONS ROW -->
  <div class="lessons-row">
    <div class="card">
      <div class="card-header">
        <h3>üß† Self-Learned Lessons</h3>
      </div>
      <div class="card-body">
        <ul class="lesson-list" id="lessons">
          <li class="lesson-item">
            <span class="lesson-time">2 min ago</span>
            High-confidence macro events (Fed decisions) have better EV than binary crypto price targets. Shift allocation +15% toward macro.
          </li>
          <li class="lesson-item">
            <span class="lesson-time">18 min ago</span>
            Entering positions when contract price is 65-80¬¢ yields best risk/reward. Below 50¬¢ = too uncertain, above 85¬¢ = poor upside.
          </li>
          <li class="lesson-item">
            <span class="lesson-time">1 hr ago</span>
            CPI trades have lower hit rate (42%) than initially modeled. Consider reducing position size on inflation-linked markets by 20%.
          </li>
        </ul>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h3>‚ö° Self-Learned Implementations</h3>
      </div>
      <div class="card-body">
        <ul class="lesson-list" id="implementations">
          <li class="lesson-item impl">
            <span class="lesson-time">5 min ago</span>
            Adjusted RSI sensitivity from 30/70 to 25/75 for 15m prediction markets after backtesting showed 8% improvement in entries.
          </li>
          <li class="lesson-item impl">
            <span class="lesson-time">32 min ago</span>
            Enabled momentum-based position sizing: trades with RSI divergence now get 1.5x base allocation.
          </li>
          <li class="lesson-item impl">
            <span class="lesson-time">2 hr ago</span>
            Auto-scaled down CPI market exposure from 15% ‚Üí 10% portfolio allocation based on rolling 20-trade performance review.
          </li>
        </ul>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h3>üîß Manual Implementations</h3>
      </div>
      <div class="card-body">
        <ul class="lesson-list" id="manual">
          <li class="lesson-item manual">
            <span class="lesson-time">Today 9:15 AM</span>
            Set max position size to $200 per trade. No single contract > 10% of wallet balance.
          </li>
          <li class="lesson-item manual">
            <span class="lesson-time">Today 8:00 AM</span>
            Blacklisted sports markets‚Äîsticking to macro, crypto, and politics only. Higher edge with data-driven predictions.
          </li>
          <li class="lesson-item manual">
            <span class="lesson-time">Yesterday</span>
            Added 2-minute cooldown between trades to prevent revenge trading after losses.
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- BRAIN ACTIVITY -->
  <div class="brain-section">
    <div class="brain-section-header">
      <h2 class="brain-section-title">üß† Brain Activity</h2>
      <span class="badge badge-live">‚óè LIVE FEED</span>
    </div>

    <div class="brain-grid">
      <!-- LEFT BRAIN -->
      <div class="brain-card left-brain">
        <div class="brain-card-header">
          <div class="brain-icon left">L</div>
          <div class="brain-label-group">
            <h3 class="brain-name">Left Brain</h3>
            <span class="brain-role">Analytical ¬∑ Data-Driven ¬∑ Risk Assessment</span>
          </div>
          <div class="brain-status" id="leftBrainStatus">ANALYZING</div>
        </div>
        <div class="brain-thought-stream" id="leftBrainStream">
          <div class="thought-entry">
            <span class="thought-time">just now</span>
            <span class="thought-action skip">SKIP</span>
            <div class="thought-text">
              <strong>S&P 500 closes green tomorrow</strong> ‚Äî Contract at 52¬¢. RSI(14) = 48.2, no clear directional signal. Historical accuracy on next-day S&P calls is only 41%. EV is slightly negative at this price point. <em>Insufficient edge ‚Üí skip.</em>
            </div>
          </div>
          <div class="thought-entry">
            <span class="thought-time">2 min ago</span>
            <span class="thought-action buy">BUY</span>
            <div class="thought-text">
              <strong>Fed holds rate March meeting</strong> ‚Äî Contract at 72¬¢. CME FedWatch shows 89.5% probability of hold. RSI divergence detected on rate-sensitive assets. 72¬¢ for 89.5% implied = 17.5¬¢ edge. <em>Strong buy signal ‚Üí $150 position @ 72¬¢.</em>
            </div>
          </div>
          <div class="thought-entry">
            <span class="thought-time">8 min ago</span>
            <span class="thought-action sell">SELL</span>
            <div class="thought-text">
              <strong>BTC above $108K by Feb 15</strong> ‚Äî Holding from 61¬¢, now trading at 84¬¢. RSI(15m) hitting 78 on BTC, approaching overbought. Realized +37.7% gain. Risk/reward deteriorating as contract nears ceiling. <em>Take profit ‚Üí close position.</em>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT BRAIN -->
      <div class="brain-card right-brain">
        <div class="brain-card-header">
          <div class="brain-icon right">R</div>
          <div class="brain-label-group">
            <h3 class="brain-name">Right Brain</h3>
            <span class="brain-role">Intuitive ¬∑ Sentiment ¬∑ Pattern Recognition</span>
          </div>
          <div class="brain-status" id="rightBrainStatus">SENSING</div>
        </div>
        <div class="brain-thought-stream" id="rightBrainStream">
          <div class="thought-entry">
            <span class="thought-time">just now</span>
            <span class="thought-action skip">SKIP</span>
            <div class="thought-text">
              <strong>S&P 500 closes green tomorrow</strong> ‚Äî Market vibes are mixed. Twitter/X sentiment split 50/50, no dominant narrative forming. Weekend gap risk is high. No strong gut read on direction. <em>No conviction ‚Üí agreeing with Left Brain, skip.</em>
            </div>
          </div>
          <div class="thought-entry">
            <span class="thought-time">2 min ago</span>
            <span class="thought-action buy">BUY</span>
            <div class="thought-text">
              <strong>Fed holds rate March meeting</strong> ‚Äî Every macro influencer is aligned on "hold." Crypto Twitter isn't even debating this one. Consensus sentiment feels like a lock. News flow since last CPI all points dovish-hold. <em>High conviction alignment ‚Üí confirming Left Brain buy.</em>
            </div>
          </div>
          <div class="thought-entry">
            <span class="thought-time">8 min ago</span>
            <span class="thought-action sell">SELL</span>
            <div class="thought-text">
              <strong>BTC above $108K by Feb 15</strong> ‚Äî The euphoria pattern is showing again: too many "we're so back" posts. Whale wallet movements on-chain suggest distribution, not accumulation. This rally feels like it needs to breathe. <em>Euphoria detector triggered ‚Üí confirming exit.</em>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</main>

<!-- FOOTER -->
<footer class="footer">
  <span>OSHI v1.0 ¬∑ <a href="https://x.com/PredictwithOshi" target="_blank" class="footer-oshi-x">ùïè @PredictwithOshi</a></span>
</footer>

<script>
const API_BASE = '/api';  // Proxied through Netlify to avoid mixed content
let sessionStartTime = null;
const STARTING_BALANCE = 192.00; // Two-Brain v2 baseline

// Toggle status (manual override)
function toggleStatus() {
  const track = document.getElementById('toggleTrack');
  const label = document.getElementById('statusLabel');
  const isOn = track.classList.toggle('on');
  label.textContent = isOn ? 'RUNNING' : 'OFFLINE';
  label.style.color = isOn ? 'var(--profit)' : 'var(--loss)';
}

// Particle system
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let particles = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

class Particle {
  constructor() { this.reset(); }
  reset() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.size = Math.random() * 2 + 0.5;
    this.speedY = -(Math.random() * 0.3 + 0.1);
    this.speedX = (Math.random() - 0.5) * 0.2;
    this.opacity = Math.random() * 0.4 + 0.1;
    this.color = Math.random() > 0.5 ? '0, 229, 195' : '57, 255, 20';
  }
  update() {
    this.y += this.speedY;
    this.x += this.speedX;
    if (this.y < -10) { this.reset(); this.y = canvas.height + 10; }
  }
  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(${this.color}, ${this.opacity})`;
    ctx.fill();
  }
}
for (let i = 0; i < 60; i++) particles.push(new Particle());
function animateParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particles.forEach(p => { p.update(); p.draw(); });
  requestAnimationFrame(animateParticles);
}
animateParticles();

// Format time ago
function timeAgo(dateStr) {
  const now = new Date();
  const then = new Date(dateStr);
  const mins = Math.floor((now - then) / 60000);
  if (mins < 1) return 'just now';
  if (mins < 60) return `${mins} min ago`;
  const hrs = Math.floor(mins / 60);
  if (hrs < 24) return `${hrs}h ago`;
  return `${Math.floor(hrs / 24)}d ago`;
}

// Calculate uptime from session start
function updateUptime() {
  if (!sessionStartTime) return;
  const now = new Date();
  const start = new Date(sessionStartTime);
  const mins = Math.floor((now - start) / 60000);
  const h = Math.floor(mins / 60);
  const m = mins % 60;
  document.getElementById('uptime').textContent = `${h}h ${m.toString().padStart(2, '0')}m`;
}

// Fetch status from API
async function fetchStatus() {
  try {
    const res = await fetch(`${API_BASE}/status`);
    const data = await res.json();
    
    // Update current balance
    const currentBalanceEl = document.getElementById('currentBalance');
    if (currentBalanceEl) {
      currentBalanceEl.textContent = `$${data.balance.toFixed(2)}`;
    }
    
    // Update status indicator
    const label = document.getElementById('statusLabel');
    const track = document.getElementById('toggleTrack');
    if (data.running) {
      label.textContent = 'RUNNING';
      label.style.color = 'var(--profit)';
      if (track) track.classList.add('on');
    } else {
      label.textContent = 'OFFLINE';
      label.style.color = 'var(--loss)';
      if (track) track.classList.remove('on');
    }
    
    // Session start time for uptime
    if (data.session_started) {
      sessionStartTime = data.session_started;
      updateUptime();
    }
    
    // Calculate P&L (current - starting balance)
    const pnl = data.balance - STARTING_BALANCE;
    const pnlPct = (pnl / STARTING_BALANCE) * 100;
    
    const totalPnlEl = document.getElementById('totalPnl');
    const pnlPctEl = document.getElementById('pnlPct');
    
    if (totalPnlEl) {
      const sign = pnl >= 0 ? '+' : '';
      totalPnlEl.textContent = `${sign}$${pnl.toFixed(2)}`;
      totalPnlEl.className = `pnl-value ${pnl >= 0 ? 'positive' : 'negative'}`;
    }
    
    if (pnlPctEl) {
      const sign = pnlPct >= 0 ? '+' : '';
      pnlPctEl.textContent = `${sign}${pnlPct.toFixed(1)}%`;
      pnlPctEl.className = `pnl-pct ${pnlPct >= 0 ? 'positive' : 'negative'}`;
    }
  } catch (e) {
    console.error('Status fetch failed:', e);
  }
}

// Fetch trades and calculate win rate
async function fetchTrades() {
  try {
    const res = await fetch(`${API_BASE}/trades`);
    const data = await res.json();
    const trades = data.recent || [];
    
    // Calculate win rate from all trades
    const completedTrades = trades.filter(t => t.won !== undefined);
    const wins = completedTrades.filter(t => t.won).length;
    const winRate = completedTrades.length > 0 ? (wins / completedTrades.length * 100) : 0;
    
    const winRateEl = document.getElementById('winRate');
    if (winRateEl) {
      winRateEl.textContent = `${winRate.toFixed(1)}%`;
      winRateEl.style.color = winRate >= 50 ? 'var(--profit)' : 'var(--loss)';
    }
    
    // Update Recent Trades list
    const tradesListEl = document.getElementById('recentTrades');
    if (tradesListEl && completedTrades.length > 0) {
      tradesListEl.innerHTML = completedTrades.slice(0, 8).map(t => {
        const asset = t.ticker?.includes('BTC') ? 'BTC' : t.ticker?.includes('SOL') ? 'SOL' : 'ETH';
        const side = (t.side || '').toUpperCase();
        const resultClass = t.won ? 'win' : 'loss';
        const result = t.won ? 'WIN' : 'LOSS';
        const pnl = t.pnl || 0;
        const pnlPct = t.pnl_pct || 0;
        const pnlClass = pnl >= 0 ? 'positive' : 'negative';
        const pnlSign = pnl >= 0 ? '+' : '';
        const closeType = t.close_type || '';
        const typeIcon = closeType === 'DETERMINED' ? '‚è∞' : closeType.includes('EARLY') ? 'üí∞' : 'üìä';
        
        return `
          <li class="trade-item">
            <span class="trade-name">${typeIcon} ${asset} ${side} @ ${t.price || 0}¬¢</span>
            <span class="trade-result ${resultClass}">${result}</span>
            <span class="trade-pct">${pnlSign}${pnlPct.toFixed(1)}%</span>
            <span class="trade-pnl ${pnlClass}">${pnlSign}$${Math.abs(pnl).toFixed(2)}</span>
          </li>
        `;
      }).join('');
    }
    
    // Update brain activity streams with recent trades
    updateBrainStreams(trades.slice(0, 5));
    
  } catch (e) {
    console.error('Trades fetch failed:', e);
  }
}

// Fetch brain lessons
async function fetchBrain() {
  try {
    const res = await fetch(`${API_BASE}/brain`);
    const data = await res.json();
    
    // Update lessons
    const lessonsEl = document.getElementById('lessons');
    if (lessonsEl && data.lessons?.length) {
      lessonsEl.innerHTML = data.lessons.slice(0, 5).map(l => `
        <li class="lesson-item ${l.won ? 'win' : 'loss'}">
          <span class="lesson-time">${timeAgo(l.timestamp)}</span>
          ${l.key_lesson}
        </li>
      `).join('');
    }
    
    // Update auto implementations
    const implEl = document.getElementById('implementations');
    if (implEl && data.auto_implementations?.length) {
      implEl.innerHTML = data.auto_implementations.slice(0, 5).map(i => `
        <li class="lesson-item impl">
          <span class="lesson-time">${timeAgo(i.timestamp)}</span>
          ${i.description || i.key_lesson}
        </li>
      `).join('');
    }
  } catch (e) {
    console.error('Brain fetch failed:', e);
  }
}

// Update brain streams with trade analysis
function updateBrainStreams(trades) {
  const leftStream = document.getElementById('leftBrainStream');
  const rightStream = document.getElementById('rightBrainStream');
  
  if (!leftStream || !rightStream || !trades.length) return;
  
  // Left Brain: Analytical view
  leftStream.innerHTML = trades.map(t => {
    const action = t.won ? (t.side === 'yes' ? 'buy' : 'sell') : 'skip';
    const actionClass = t.won ? (t.pnl > 0 ? 'buy' : 'sell') : 'skip';
    const asset = t.ticker?.includes('BTC') ? 'BTC' : t.ticker?.includes('SOL') ? 'SOL' : 'ETH';
    return `
      <div class="thought-entry">
        <span class="thought-time">${timeAgo(t.timestamp)}</span>
        <span class="thought-action ${actionClass}">${t.side?.toUpperCase() || 'TRADE'}</span>
        <div class="thought-text">
          <strong>${asset} ${t.side?.toUpperCase()}</strong> ‚Äî ${t.contracts} contracts @ ${t.price}¬¢. 
          RSI: ${t.rsi?.toFixed(0) || 'N/A'}, ADX: ${t.adx?.toFixed(0) || 'N/A'}. 
          Tier: ${t.tier || 'N/A'}, Edge: ${((t.edge || 0) * 100).toFixed(1)}%. 
          <em>${t.won ? `Won +$${t.pnl?.toFixed(2)} (${t.pnl_pct?.toFixed(0)}%)` : `Lost $${Math.abs(t.pnl || 0).toFixed(2)}`}</em>
        </div>
      </div>
    `;
  }).join('');
  
  // Right Brain: Pattern/sentiment view
  rightStream.innerHTML = trades.map(t => {
    const asset = t.ticker?.includes('BTC') ? 'BTC' : t.ticker?.includes('SOL') ? 'SOL' : 'ETH';
    const sentiment = t.won ? 'Signal confirmed by price action' : 'Market moved against position';
    return `
      <div class="thought-entry">
        <span class="thought-time">${timeAgo(t.timestamp)}</span>
        <span class="thought-action ${t.won ? 'buy' : 'sell'}">${t.won ? 'HIT' : 'MISS'}</span>
        <div class="thought-text">
          <strong>${asset} ${t.close_type || 'CLOSE'}</strong> ‚Äî ${sentiment}. 
          ${t.tier === 'S+' ? 'Mispricing opportunity detected.' : ''} 
          ${t.pnl_pct > 50 ? 'Strong momentum play.' : t.pnl_pct < -50 ? 'Reversal caught us.' : 'Standard execution.'}
          <em>${t.won ? '‚úì Pattern held' : '‚úó Pattern failed'}</em>
        </div>
      </div>
    `;
  }).join('');
}

// Fetch current positions
async function fetchPositions() {
  try {
    const res = await fetch(`${API_BASE}/positions`);
    const data = await res.json();
    
    const listEl = document.getElementById('positionsList');
    const badgeEl = document.getElementById('positionsBadge');
    
    if (!listEl) return;
    
    const positions = data.positions || [];
    
    // Update badge
    if (badgeEl) {
      badgeEl.textContent = positions.length > 0 ? `${positions.length} OPEN` : '0 OPEN';
      badgeEl.classList.toggle('has-positions', positions.length > 0);
    }
    
    // Render positions
    if (positions.length === 0) {
      listEl.innerHTML = '<div class="no-positions">No current positions</div>';
      return;
    }
    
    listEl.innerHTML = positions.map(p => {
      const pnlClass = p.unrealized_pnl >= 0 ? 'positive' : 'negative';
      const pnlSign = p.unrealized_pnl >= 0 ? '+' : '';
      return `
        <div class="position-item">
          <span class="position-asset">${p.asset}</span>
          <span class="position-side ${p.side}">${p.side.toUpperCase()}</span>
          <span class="position-entry">${p.contracts}x @ ${p.entry_price}¬¢</span>
          <span class="position-current">Now: ${p.current_price}¬¢</span>
          <span class="position-size">$${p.size_usd.toFixed(2)}</span>
          <span class="position-pnl ${pnlClass}">${pnlSign}$${p.unrealized_pnl.toFixed(2)}</span>
        </div>
      `;
    }).join('');
    
  } catch (e) {
    console.error('Positions fetch failed:', e);
  }
}

// Fetch leaderboard data
async function fetchLeaderboard() {
  try {
    const res = await fetch(`${API_BASE}/all`);
    const data = await res.json();
    const lb = data.leaderboard || {};
    
    const renderLeaderboard = (elId, items, isWorst = false) => {
      const el = document.getElementById(elId);
      if (!el || !items?.length) return;
      
      el.innerHTML = items.slice(0, 5).map((t, i) => {
        const asset = t.ticker?.includes('BTC') ? 'BTC' : t.ticker?.includes('SOL') ? 'SOL' : 'ETH';
        const side = (t.side || '').toUpperCase();
        const pnl = t.pnl || 0;
        const pnlPct = t.pnl_pct || ((pnl / (t.size_usd || 1)) * 100);
        const pnlClass = pnl >= 0 ? 'positive' : 'negative';
        const pnlSign = pnl >= 0 ? '+' : '';
        const rankClass = isWorst 
          ? `style="background:rgba(255,59,92,${0.12 - i*0.03});color:var(--loss);"`
          : (i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : 'normal');
        const rankAttr = isWorst ? rankClass : `class="rank ${rankClass}"`;
        
        return `
          <li class="leader-item">
            <span ${rankAttr}>${i + 1}</span>
            <span class="trade-name">${asset} ${side} @ ${t.price || t.entry_price || 0}¬¢</span>
            <span class="trade-pct">${pnlSign}${pnlPct.toFixed(1)}%</span>
            <span class="trade-pnl ${pnlClass}">${pnlSign}$${Math.abs(pnl).toFixed(2)}</span>
          </li>
        `;
      }).join('');
    };
    
    renderLeaderboard('sessionTop', lb.session_top, false);
    renderLeaderboard('sessionWorst', lb.session_bottom, true);
    renderLeaderboard('allTimeTop', lb.all_time_top, false);
    renderLeaderboard('allTimeWorst', lb.all_time_bottom, true);
    
  } catch (e) {
    console.error('Leaderboard fetch failed:', e);
  }
}

// Fetch P&L separately for accuracy
async function fetchPnL() {
  try {
    const res = await fetch(`${API_BASE}/pnl`);
    const data = await res.json();
    
    const session = data.session || {};
    const wallet = data.wallet || {};
    
    // Session P&L
    const sessionPnlEl = document.getElementById('sessionPnl');
    const sessionPctEl = document.getElementById('sessionPct');
    if (sessionPnlEl) {
      const pnl = session.pnl || 0;
      sessionPnlEl.textContent = `${pnl >= 0 ? '+' : ''}$${Math.abs(pnl).toFixed(2)}`;
      sessionPnlEl.className = `pnl-value ${pnl >= 0 ? 'positive' : 'negative'}`;
    }
    if (sessionPctEl) {
      const pct = session.pct || 0;
      sessionPctEl.textContent = `${pct >= 0 ? '+' : ''}${pct.toFixed(1)}%`;
      sessionPctEl.className = `pnl-pct ${pct >= 0 ? 'positive' : 'negative'}`;
    }
    
    // Total P&L from wallet
    const totalPnlEl = document.getElementById('totalPnl');
    const pnlPctEl = document.getElementById('pnlPct');
    if (totalPnlEl) {
      const pnl = wallet.pnl || 0;
      totalPnlEl.textContent = `${pnl >= 0 ? '+' : ''}$${Math.abs(pnl).toFixed(2)}`;
      totalPnlEl.className = `pnl-value ${pnl >= 0 ? 'positive' : 'negative'}`;
    }
    if (pnlPctEl) {
      const pct = wallet.pct || 0;
      pnlPctEl.textContent = `${pct >= 0 ? '+' : ''}${pct.toFixed(1)}%`;
      pnlPctEl.className = `pnl-pct ${pct >= 0 ? 'positive' : 'negative'}`;
    }
    
    // Win rate from session
    const winRateEl = document.getElementById('winRate');
    if (winRateEl) {
      const wr = session.win_rate || 0;
      winRateEl.textContent = `${wr.toFixed(1)}%`;
      winRateEl.style.color = wr >= 50 ? 'var(--profit)' : 'var(--loss)';
    }
    
    // Trades today
    const tradesTodayEl = document.getElementById('tradesToday');
    if (tradesTodayEl) {
      tradesTodayEl.textContent = (session.wins || 0) + (session.losses || 0);
    }
    
  } catch (e) {
    console.error('P&L fetch failed:', e);
  }
}

// Leaderboard tab switching
function switchLeaderboardTab(tab) {
  // Update tab buttons
  document.querySelectorAll('.lb-tab').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.tab === tab);
  });
  
  // Update content panels
  document.querySelectorAll('.lb-content').forEach(panel => {
    panel.classList.toggle('active', panel.id === `lb-${tab}`);
  });
}

// Initial fetch and refresh loop
fetchStatus();
fetchPositions();
fetchTrades();
fetchBrain();
fetchLeaderboard();
fetchPnL();
setInterval(fetchStatus, 15000);  // Every 15s
setInterval(fetchPositions, 10000); // Every 10s (positions are time-sensitive)
setInterval(fetchTrades, 30000);  // Every 30s
setInterval(fetchBrain, 60000);   // Every 60s
setInterval(fetchLeaderboard, 30000); // Every 30s
setInterval(fetchPnL, 15000); // Every 15s
setInterval(updateUptime, 60000); // Update uptime every minute

// Register Service Worker for PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js')
    .then(() => console.log('OSHI PWA ready'))
    .catch(err => console.log('SW registration failed:', err));
}
</script>
</body>
</html>
<!-- Deploy trigger: 1770592194 -->
<!-- Redeploy: 1770598274 -->
<!-- webhook trigger 1770598888 -->
