<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚ú® Oshi ‚Äî Prediction Agent Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --oshi-teal: #00d4aa;
  --oshi-teal-light: #00ffd0;
  --oshi-teal-glow: rgba(0, 212, 170, 0.4);
  --kalshi: #00d4aa;
  --kalshi-glow: rgba(0, 212, 170, 0.3);
  --polymarket: #00a8ff;
  --polymarket-glow: rgba(0, 168, 255, 0.3);
  --pink: #ff6b9d;
  --pink-glow: rgba(255, 107, 157, 0.3);
  --purple: #a855f7;
  --purple-glow: rgba(168, 85, 247, 0.3);
  --gold: #ffd700;
  --win: #00d4aa;
  --loss: #ff5c8a;
  --neutral: #8892b0;
  --bg-deep: #0a0e1a;
  --bg-card: rgba(15, 20, 35, 0.95);
  --bg-glass: rgba(255, 255, 255, 0.03);
  --border: rgba(0, 212, 170, 0.15);
  --border-glow: rgba(0, 212, 170, 0.4);
  --text-primary: #f0f4ff;
  --text-secondary: #8892b0;
  --text-dim: #5a6480;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg-deep);
  color: var(--text-primary);
  font-family: 'Quicksand', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

.bg-effects {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  pointer-events: none;
  z-index: 0;
}

.bg-gradient {
  position: absolute;
  width: 100%; height: 100%;
  background: 
    radial-gradient(ellipse at 20% 20%, rgba(0, 212, 170, 0.08) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 80%, rgba(0, 168, 255, 0.08) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 50%, rgba(168, 85, 247, 0.05) 0%, transparent 60%);
}

.sparkle {
  position: absolute;
  width: 4px; height: 4px;
  background: white;
  border-radius: 50%;
  animation: sparkle 3s ease-in-out infinite;
  box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.5);
}

@keyframes sparkle {
  0%, 100% { opacity: 0; transform: scale(0); }
  50% { opacity: 1; transform: scale(1); }
}

/* === DECISIONS PANEL === */
.decisions-section {
  margin-bottom: 30px;
}

.decisions-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.decisions-column {
  background: var(--bg-card);
  border-radius: 16px;
  border: 1px solid var(--border);
  overflow: hidden;
}

.decisions-column.kalshi { border-top: 3px solid var(--kalshi); }
.decisions-column.polymarket { border-top: 3px solid var(--polymarket); }

.decisions-column-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: var(--bg-glass);
  border-bottom: 1px solid var(--border);
}

.decisions-column-header h4 {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 1px;
}

.decisions-list {
  max-height: 280px;
  overflow-y: auto;
  padding: 8px;
}

.decision-row {
  display: flex;
  flex-direction: column;
  padding: 10px 12px;
  margin-bottom: 6px;
  background: var(--bg-glass);
  border-radius: 10px;
  border-left: 3px solid var(--neutral);
  transition: all 0.2s ease;
}

.decision-row:hover {
  background: rgba(255, 255, 255, 0.05);
}

.decision-row.trade { border-left-color: var(--win); }
.decision-row.skip { border-left-color: var(--loss); }

.decision-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

.decision-market {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-primary);
}

.decision-time {
  font-size: 10px;
  color: var(--text-dim);
}

.decision-outcome {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 4px;
}

.decision-outcome.trade {
  background: rgba(0, 212, 170, 0.15);
  color: var(--win);
}

.decision-outcome.skip {
  background: rgba(255, 92, 138, 0.15);
  color: var(--loss);
}

.decision-indicators {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 6px;
}

.indicator-tag {
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 4px;
  background: rgba(255, 255, 255, 0.05);
  color: var(--text-secondary);
  font-family: 'Space Mono', monospace;
}

.indicator-tag.up {
  background: rgba(0, 212, 170, 0.15);
  color: var(--win);
}

.indicator-tag.down {
  background: rgba(255, 92, 138, 0.15);
  color: var(--loss);
}

.indicator-tag.neutral {
  background: rgba(136, 146, 176, 0.15);
  color: var(--neutral);
}

.decision-reason {
  font-size: 11px;
  color: var(--text-dim);
  font-style: italic;
}

.confluence-badge {
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 4px;
  background: rgba(168, 85, 247, 0.2);
  color: var(--purple);
  font-weight: 600;
}

@media (max-width: 900px) {
  .decisions-grid { grid-template-columns: 1fr; }
}




.main-container {
  position: relative;
  z-index: 1;
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

/* === HERO HEADER === */
.hero-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 30px 40px;
  margin-bottom: 30px;
  background: var(--bg-card);
  border-radius: 24px;
  border: 1px solid var(--border);
  position: relative;
  overflow: hidden;
}

.hero-header::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--kalshi), var(--purple), var(--polymarket));
}

.hero-left {
  display: flex;
  align-items: center;
  gap: 24px;
  z-index: 2;
}

.oshi-avatar-container { position: relative; }

.oshi-avatar {
  width: 100px; height: 100px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid var(--oshi-teal);
  box-shadow: 0 0 20px var(--oshi-teal-glow), 0 0 40px var(--oshi-teal-glow);
  animation: avatarGlow 3s ease-in-out infinite;
}

@keyframes avatarGlow {
  0%, 100% { box-shadow: 0 0 20px var(--oshi-teal-glow), 0 0 40px var(--oshi-teal-glow); }
  50% { box-shadow: 0 0 30px var(--oshi-teal-glow), 0 0 60px var(--oshi-teal-glow); }
}

.avatar-ring {
  position: absolute;
  top: -5px; left: -5px; right: -5px; bottom: -5px;
  border: 2px solid transparent;
  border-top-color: var(--pink);
  border-radius: 50%;
  animation: spin 4s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

.hero-brand h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 36px;
  font-weight: 700;
  letter-spacing: 4px;
  background: linear-gradient(135deg, var(--oshi-teal-light), var(--oshi-teal), var(--polymarket));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.hero-brand .tagline {
  font-size: 14px;
  color: var(--text-secondary);
  letter-spacing: 3px;
  text-transform: uppercase;
}

.hero-right {
  display: flex;
  align-items: center;
  gap: 20px;
  z-index: 2;
}

.status-pill {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 24px;
  background: linear-gradient(135deg, rgba(0, 212, 170, 0.15), rgba(0, 168, 255, 0.15));
  border-radius: 50px;
  border: 1px solid var(--border);
}

.status-dot {
  width: 10px; height: 10px;
  background: var(--oshi-teal);
  border-radius: 50%;
  animation: pulse 2s ease-in-out infinite;
  box-shadow: 0 0 10px var(--oshi-teal);
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.2); opacity: 0.7; }
}

.status-text {
  font-family: 'Space Mono', monospace;
  font-size: 13px;
  color: var(--oshi-teal);
  letter-spacing: 1px;
}

.trade-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: linear-gradient(135deg, var(--kalshi), var(--oshi-teal-light));
  border: none;
  border-radius: 12px;
  color: var(--bg-deep);
  font-family: 'Quicksand', sans-serif;
  font-size: 14px;
  font-weight: 700;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px var(--kalshi-glow);
}

.trade-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 25px var(--kalshi-glow);
}

.social-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px; height: 44px;
  border-radius: 12px;
  text-decoration: none;
  transition: all 0.3s ease;
  background: var(--bg-glass);
  border: 1px solid var(--text-dim);
  color: var(--text-primary);
}

.social-btn:hover {
  background: var(--text-primary);
  color: var(--bg-deep);
  transform: translateY(-2px);
}

/* === BALANCE BANNER === */
.balance-banner {
  display: flex;
  justify-content: center;
  gap: 60px;
  padding: 24px 40px;
  margin-bottom: 30px;
  background: var(--bg-card);
  border-radius: 20px;
  border: 1px solid var(--border);
}

.balance-item {
  display: flex;
  align-items: center;
  gap: 16px;
}

.balance-icon {
  width: 50px; height: 50px;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  overflow: hidden;
}

.platform-logo-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 12px;
}

.header-logo {
  width: 22px;
  height: 22px;
  object-fit: cover;
  border-radius: 4px;
  vertical-align: middle;
  margin-right: 6px;
}

.trade-logo {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 8px;
}

.balance-item.kalshi .balance-icon {
  background: linear-gradient(135deg, rgba(0, 212, 170, 0.2), rgba(0, 212, 170, 0.05));
  border: 1px solid var(--kalshi);
  box-shadow: 0 0 20px var(--kalshi-glow);
}

.balance-item.polymarket .balance-icon {
  background: linear-gradient(135deg, rgba(0, 168, 255, 0.2), rgba(0, 168, 255, 0.05));
  border: 1px solid var(--polymarket);
  box-shadow: 0 0 20px var(--polymarket-glow);
}

.balance-info .label {
  font-size: 12px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 4px;
}

.balance-info .value {
  font-family: 'Space Mono', monospace;
  font-size: 26px;
  font-weight: 700;
}

.balance-item.kalshi .value { color: var(--kalshi); text-shadow: 0 0 20px var(--kalshi-glow); }
.balance-item.polymarket .value { color: var(--polymarket); text-shadow: 0 0 20px var(--polymarket-glow); }

.balance-divider {
  width: 1px;
  background: linear-gradient(180deg, transparent, var(--border), transparent);
}

/* === PLATFORM GRID === */
.platform-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-bottom: 30px;
}

.platform-card {
  background: var(--bg-card);
  border-radius: 24px;
  padding: 28px;
  border: 1px solid var(--border);
  position: relative;
  overflow: hidden;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.platform-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.platform-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 4px;
  border-radius: 4px 4px 0 0;
}

.platform-card.kalshi::before {
  background: linear-gradient(90deg, var(--kalshi), var(--oshi-teal-light));
  box-shadow: 0 0 20px var(--kalshi-glow);
}

.platform-card.polymarket::before {
  background: linear-gradient(90deg, var(--polymarket), #00d4ff);
  box-shadow: 0 0 20px var(--polymarket-glow);
}

.platform-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  position: relative;
  z-index: 2;
}

.platform-identity {
  display: flex;
  align-items: center;
  gap: 16px;
}

.platform-logo {
  width: 56px; height: 56px;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  transition: transform 0.2s ease;
}

.platform-logo:hover { transform: scale(1.05); }
.platform-logo img { width: 40px; height: 40px; border-radius: 8px; }

.kalshi .platform-logo {
  background: linear-gradient(135deg, rgba(0, 212, 170, 0.25), rgba(0, 212, 170, 0.1));
  border: 2px solid var(--kalshi);
  box-shadow: 0 0 20px var(--kalshi-glow);
}

.polymarket .platform-logo {
  background: linear-gradient(135deg, rgba(0, 168, 255, 0.25), rgba(0, 168, 255, 0.1));
  border: 2px solid var(--polymarket);
  box-shadow: 0 0 20px var(--polymarket-glow);
}

.platform-meta h2 {
  font-family: 'Orbitron', sans-serif;
  font-size: 18px;
  letter-spacing: 3px;
}

.kalshi .platform-meta h2 { color: var(--kalshi); }
.polymarket .platform-meta h2 { color: var(--polymarket); }

.platform-meta .timeframe {
  font-size: 13px;
  color: var(--text-dim);
  margin-top: 2px;
}

.version-badge {
  font-family: 'Space Mono', monospace;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1px;
}

.kalshi .version-badge {
  background: rgba(0, 212, 170, 0.15);
  color: var(--kalshi);
  border: 1px solid var(--kalshi);
}

.polymarket .version-badge {
  background: rgba(0, 168, 255, 0.15);
  color: var(--polymarket);
  border: 1px solid var(--polymarket);
}

.platform-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  position: relative;
  z-index: 2;
}

.stat-card {
  background: var(--bg-glass);
  border-radius: 16px;
  padding: 20px;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
}

.stat-card:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(255, 255, 255, 0.1);
}

.stat-card .value {
  font-family: 'Space Mono', monospace;
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
}

.stat-card .value.win { color: var(--win); text-shadow: 0 0 15px var(--kalshi-glow); }
.stat-card .value.loss { color: var(--loss); text-shadow: 0 0 15px var(--pink-glow); }
.stat-card .value.neutral { color: var(--neutral); }
.stat-card .value.positive { color: var(--win); }
.stat-card .value.negative { color: var(--loss); }

.stat-card .label {
  font-size: 11px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 2px;
}

/* === SECTION CARD === */
.section-card {
  background: var(--bg-card);
  border-radius: 24px;
  padding: 28px;
  margin-bottom: 24px;
  border: 1px solid var(--border);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
}

.section-header h3 {
  font-family: 'Orbitron', sans-serif;
  font-size: 14px;
  letter-spacing: 3px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 10px;
}

/* === TRADES GRID (Side by Side) === */
.trades-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
}

.trades-column {
  background: var(--bg-glass);
  border-radius: 16px;
  padding: 20px;
  border: 1px solid var(--border);
}

.trades-column.kalshi { border-top: 3px solid var(--kalshi); }
.trades-column.polymarket { border-top: 3px solid var(--polymarket); }

.trades-column-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
}

.trades-column-header h4 {
  font-family: 'Orbitron', sans-serif;
  font-size: 13px;
  letter-spacing: 2px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.trades-column.kalshi h4 { color: var(--kalshi); }
.trades-column.polymarket h4 { color: var(--polymarket); }

.streak-badge {
  display: inline-block;
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  padding: 3px 8px;
  margin-left: 8px;
  border-radius: 8px;
  background: linear-gradient(135deg, rgba(255, 107, 157, 0.2), rgba(255, 215, 0, 0.2));
  color: var(--gold);
  border: 1px solid rgba(255, 215, 0, 0.4);
  vertical-align: middle;
}

.streak-badge.hot {
  background: linear-gradient(135deg, rgba(255, 107, 157, 0.3), rgba(255, 215, 0, 0.3));
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
  animation: streakPulse 1.5s ease-in-out infinite;
}

@keyframes streakPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.trades-column-header .version {
  font-family: 'Space Mono', monospace;
  font-size: 10px;
  padding: 4px 8px;
  border-radius: 6px;
}

.trades-column.kalshi .version {
  background: rgba(0, 212, 170, 0.15);
  color: var(--kalshi);
}

.trades-column.polymarket .version {
  background: rgba(0, 168, 255, 0.15);
  color: var(--polymarket);
}

.trades-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-height: 350px;
  overflow-y: auto;
}

.trade-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.02);
  border-radius: 12px;
  transition: all 0.3s ease;
}

.trade-row:hover { background: rgba(255, 255, 255, 0.05); }

.trade-icon {
  width: 36px; height: 36px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}

.trade-row.kalshi .trade-icon { background: rgba(0, 212, 170, 0.15); }
.trade-row.polymarket .trade-icon { background: rgba(0, 168, 255, 0.15); }

.trade-info { flex: 1; }

.trade-market {
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 2px;
}

.trade-meta {
  font-size: 11px;
  color: var(--text-dim);
}

.trade-outcome {
  padding: 4px 10px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1px;
}

.trade-outcome.win {
  background: linear-gradient(135deg, rgba(0, 212, 170, 0.2), rgba(0, 212, 170, 0.1));
  color: var(--win);
  border: 1px solid var(--win);
}

.trade-outcome.loss {
  background: linear-gradient(135deg, rgba(255, 92, 138, 0.2), rgba(255, 92, 138, 0.1));
  color: var(--loss);
  border: 1px solid var(--loss);
}

.trade-pnl {
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  font-weight: 700;
  min-width: 70px;
  text-align: right;
}

.trade-pnl.positive { color: var(--win); }
.trade-pnl.negative { color: var(--loss); }

/* === POSITION TOOLTIP === */
.position-stat {
  position: relative;
  cursor: pointer;
}

.position-stat:hover .position-tooltip,
.position-stat.active .position-tooltip {
  display: block;
}

.position-tooltip {
  display: none;
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 16px;
  min-width: 280px;
  z-index: 100;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  margin-bottom: 10px;
}

/* Mobile adjustments */
@media (max-width: 768px) {
  .position-tooltip {
    position: fixed;
    bottom: auto;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    min-width: 85vw;
    max-width: 320px;
    margin-bottom: 0;
  }
  
  .position-tooltip::after {
    display: none;
  }
  
  .position-stat.active::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 99;
  }
}

.position-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 8px solid transparent;
  border-top-color: var(--border);
}

.position-tooltip h5 {
  font-size: 11px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
  border-bottom: 1px solid var(--border);
  padding-bottom: 6px;
}

.position-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.position-item:last-child {
  border-bottom: none;
}

.position-asset {
  font-weight: 600;
  color: var(--text-primary);
}

.position-details {
  text-align: right;
  font-size: 12px;
}

.position-details .direction {
  color: var(--oshi-teal);
  font-weight: 600;
}

.position-details .direction.down {
  color: var(--pink);
}

.position-details .entry {
  color: var(--text-secondary);
}

.position-details .potential {
  color: var(--win);
  font-weight: 600;
}

.no-positions {
  color: var(--text-dim);
  font-style: italic;
  font-size: 12px;
  text-align: center;
  padding: 8px;
}

.no-trades {
  text-align: center;
  padding: 30px;
  color: var(--text-dim);
  font-style: italic;
}

/* === FOOTER === */
.footer {
  text-align: center;
  padding: 30px;
  color: var(--text-dim);
}

.footer .refresh-line {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 10px;
}

.footer .refresh-time {
  font-family: 'Space Mono', monospace;
  color: var(--text-secondary);
}

.footer a {
  color: var(--oshi-teal);
  text-decoration: none;
}

/* === LOADING === */
.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 30px;
  color: var(--text-dim);
  gap: 10px;
}

.loader {
  width: 20px; height: 20px;
  border: 3px solid var(--border);
  border-top-color: var(--oshi-teal);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

/* === ARCHITECTURE SECTION === */
.architecture-section {
  background: linear-gradient(135deg, var(--bg-card), rgba(10, 14, 26, 0.98));
  overflow: hidden;
}

.arch-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
  padding: 20px 0;
}

.arch-row {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 30px;
  width: 100%;
}

.arch-node {
  position: relative;
  background: var(--bg-glass);
  border-radius: 20px;
  padding: 24px;
  min-width: 280px;
  max-width: 320px;
  border: 1px solid var(--border);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  overflow: hidden;
}

.arch-node:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}

.node-glow {
  position: absolute;
  width: 150px;
  height: 150px;
  border-radius: 50%;
  filter: blur(60px);
  opacity: 0.4;
  top: -30px;
  right: -30px;
  pointer-events: none;
  transition: opacity 0.3s;
}

.arch-node:hover .node-glow { opacity: 0.6; }

.spirit-glow { background: var(--purple); }
.blue-glow { background: var(--polymarket); }
.teal-glow { background: var(--kalshi); }
.gold-glow { background: var(--gold); }
.pink-glow { background: var(--pink); }

.node-icon {
  font-size: 40px;
  margin-bottom: 12px;
  display: inline-block;
}

.heart-beat {
  animation: heartbeat 1.5s ease-in-out infinite;
}

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  15% { transform: scale(1.15); }
  30% { transform: scale(1); }
  45% { transform: scale(1.1); }
}

.node-content h4 {
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  letter-spacing: 3px;
  margin-bottom: 4px;
}

.spirit-node h4 { color: var(--purple); }
.left-brain-node h4 { color: var(--polymarket); }
.right-brain-node h4 { color: var(--kalshi); }
.body-node h4 { color: var(--gold); }
.heart-node h4 { color: var(--pink); }

.node-role {
  display: inline-block;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  padding: 4px 10px;
  border-radius: 12px;
  margin-bottom: 12px;
}

.spirit-node .node-role { background: rgba(168, 85, 247, 0.2); color: var(--purple); }
.left-brain-node .node-role { background: rgba(0, 168, 255, 0.2); color: var(--polymarket); }
.right-brain-node .node-role { background: rgba(0, 212, 170, 0.2); color: var(--kalshi); }
.body-node .node-role { background: rgba(255, 215, 0, 0.2); color: var(--gold); }
.heart-node .node-role { background: rgba(255, 107, 157, 0.2); color: var(--pink); }

.node-content p {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.5;
}

.node-badge {
  position: absolute;
  top: 16px;
  right: 16px;
  font-family: 'Space Mono', monospace;
  font-size: 10px;
  padding: 4px 10px;
  border-radius: 8px;
}

.node-badge.purple {
  background: rgba(168, 85, 247, 0.2);
  color: var(--purple);
  border: 1px solid rgba(168, 85, 247, 0.4);
}

.node-indicators, .node-platforms, .node-features {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 14px;
}

.indicator, .platform, .feature {
  font-size: 11px;
  font-weight: 600;
  padding: 5px 10px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: var(--text-secondary);
}

.indicator.tier-s { background: rgba(0, 212, 170, 0.15); color: var(--kalshi); border-color: var(--kalshi); }
.indicator.tier-a { background: rgba(0, 168, 255, 0.15); color: var(--polymarket); border-color: var(--polymarket); }
.indicator.tier-b { background: rgba(168, 85, 247, 0.15); color: var(--purple); border-color: var(--purple); }

.platform.kalshi { background: rgba(0, 212, 170, 0.15); color: var(--kalshi); }
.platform.poly { background: rgba(0, 168, 255, 0.15); color: var(--polymarket); }

/* Connectors */
.arch-connector {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.arch-connector.vertical {
  height: 50px;
  width: 4px;
}

.arch-connector.vertical .connector-line {
  width: 4px;
  height: 100%;
  background: linear-gradient(180deg, var(--purple), var(--kalshi));
  border-radius: 2px;
}

.arch-connector.vertical .connector-pulse {
  position: absolute;
  width: 12px;
  height: 12px;
  background: var(--oshi-teal);
  border-radius: 50%;
  animation: connectorPulse 2s ease-in-out infinite;
  box-shadow: 0 0 15px var(--oshi-teal);
}

@keyframes connectorPulse {
  0%, 100% { top: 0; opacity: 1; }
  50% { top: 80%; opacity: 0.5; }
}

.arch-connector.horizontal {
  width: 80px;
  height: 4px;
  flex-direction: column;
  gap: 8px;
}

.arch-connector.horizontal .connector-line {
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, var(--polymarket), var(--kalshi));
  border-radius: 2px;
}

.data-flow {
  display: flex;
  gap: 6px;
  font-size: 14px;
  animation: dataFlowAnim 1.5s ease-in-out infinite;
}

@keyframes dataFlowAnim {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

.arch-connector.vertical.split {
  height: 50px;
  width: 200px;
}

.arch-connector.vertical.split .connector-branch {
  position: absolute;
  width: 4px;
  height: 100%;
  border-radius: 2px;
}

.arch-connector.vertical.split .connector-branch.left {
  left: 30%;
  background: linear-gradient(180deg, var(--kalshi), var(--gold));
}

.arch-connector.vertical.split .connector-branch.right {
  right: 30%;
  background: linear-gradient(180deg, var(--kalshi), var(--pink));
}

/* Legend */
.arch-legend {
  display: flex;
  justify-content: center;
  gap: 32px;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid var(--border);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 12px;
  color: var(--text-dim);
}

.legend-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
}

.legend-dot.analysis { background: linear-gradient(135deg, var(--polymarket), var(--kalshi)); }
.legend-dot.execution { background: linear-gradient(135deg, var(--kalshi), var(--gold)); }
.legend-dot.feedback { background: linear-gradient(135deg, var(--pink), var(--purple)); }

/* === RESPONSIVE === */
@media (max-width: 1024px) {
  .platform-grid, .trades-grid { grid-template-columns: 1fr; }
  .brain-row, .bottom-row { flex-direction: column; gap: 20px; }
  .arch-connector.horizontal { 
    width: 4px; 
    height: 40px; 
    flex-direction: row;
  }
  .arch-connector.horizontal .connector-line {
    width: 4px;
    height: 100%;
    background: linear-gradient(180deg, var(--polymarket), var(--kalshi));
  }
  .arch-connector.vertical.split {
    width: 4px;
    height: 60px;
  }
  .arch-connector.vertical.split .connector-branch {
    width: 100%;
    height: 4px;
    position: relative;
  }
  .arch-legend { flex-direction: column; align-items: center; gap: 12px; }
}

@media (max-width: 768px) {
  .hero-header {
    flex-direction: column;
    text-align: center;
    gap: 20px;
    padding: 24px;
  }
  .hero-left { flex-direction: column; }
  .balance-banner { flex-direction: column; gap: 20px; align-items: center; }
  .balance-divider { display: none; }
}

/* Balance Widget - 2 Column Layout */
.balance-item {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 16px 24px;
}

.balance-main {
  display: flex;
  align-items: center;
  gap: 16px;
}

.balance-daily {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
  padding-left: 20px;
  border-left: 1px solid rgba(255,255,255,0.1);
  min-width: 120px;
}

.balance-daily .daily-label {
  font-size: 10px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.balance-daily .daily-start {
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  color: var(--text-dim);
}

.balance-daily .daily-pnl {
  font-family: 'Space Mono', monospace;
  font-size: 16px;
  font-weight: 700;
}

.balance-daily .daily-pct {
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  opacity: 0.8;
}

.pnl-positive { color: #00ff88 !important; }
.pnl-negative { color: #ff4444 !important; }
</style>
</head>
<body>

<div class="bg-effects">
  <div class="bg-gradient"></div>
</div>

<div class="main-container">

  <!-- Hero Header -->
  <header class="hero-header">
    <div class="hero-left">
      <div class="oshi-avatar-container">
        <img src="oshi-avatar.jpg" alt="Oshi" class="oshi-avatar">
        <div class="avatar-ring"></div>
      </div>
      <div class="hero-brand">
        <h1>‚ú® OSHI</h1>
        <div class="tagline">Prediction Agent Dashboard</div>
      </div>
    </div>
    <div class="hero-right">
      <div class="status-pill">
        <div class="status-dot"></div>
        <span class="status-text">LIVE</span>
      </div>
      <a href="https://kalshi.com/sign-up/?referral=3284dc15-89f1-494b-ac60-b0d124d26b1d" target="_blank" class="trade-btn">
        <span>üéØ Trade with Oshi</span>
      </a>
      <a href="https://x.com/predictwithoshi" target="_blank" class="social-btn">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      </a>
    </div>
  </header>

  <!-- Balance Banner -->
  <div class="balance-banner">
    <div class="balance-item kalshi">
      <div class="balance-main">
        <div class="balance-icon">
          <img src="kalshi-logo.png" alt="Kalshi" class="platform-logo-img">
        </div>
        <div class="balance-info">
          <div class="label">Kalshi Balance</div>
          <div class="value" id="kalshiBalance">$--</div>
        </div>
      </div>
      <div class="balance-daily">
        <div class="daily-label">Today's P&L</div>
        <div class="daily-pnl" id="kalshiDailyPnl">--</div>
        <div class="daily-pct" id="kalshiDailyPct"></div>
        <div class="daily-start">Start: $<span id="kalshiStartBalance">--</span></div>
      </div>
    </div>
    <div class="balance-divider"></div>
    <div class="balance-item polymarket">
      <div class="balance-main">
        <div class="balance-icon">
          <img src="polymarket-logo.png" alt="Polymarket" class="platform-logo-img">
        </div>
        <div class="balance-info">
          <div class="label">Polymarket Balance</div>
          <div class="value" id="polyBalance">$--</div>
        </div>
      </div>
      <div class="balance-daily">
        <div class="daily-label">Today's P&L</div>
        <div class="daily-pnl" id="polymarketDailyPnl">--</div>
        <div class="daily-pct" id="polymarketDailyPct"></div>
        <div class="daily-start">Start: $<span id="polymarketStartBalance">--</span></div>
      </div>
    </div>
  </div>

  <!-- Platform Cards -->
  <div class="platform-grid">
    <!-- Kalshi -->
    <div class="platform-card kalshi">
      <div class="platform-header">
        <div class="platform-identity">
          <a href="https://kalshi.com/sign-up/?referral=3284dc15-89f1-494b-ac60-b0d124d26b1d" target="_blank" class="platform-logo">
            <img src="kalshi-logo.png" alt="Kalshi" class="platform-logo-img">
          </a>
          <div class="platform-meta">
            <h2>KALSHI</h2>
            <div class="timeframe">15-Min BTC/SOL Markets</div>
          </div>
        </div>
        <span class="version-badge">v10.3</span>
        <div style="font-size: 10px; color: var(--text-dim); margin-top: 4px;">Stats Reset Daily at 12 AM EST</div>
      </div>
      <div class="platform-stats">
        <div class="stat-card">
          <div class="value win" id="kalshiWins">--</div>
          <div class="label">Wins</div>
        </div>
        <div class="stat-card">
          <div class="value loss" id="kalshiLosses">--</div>
          <div class="label">Losses</div>
        </div>
        <div class="stat-card">
          <div class="value neutral" id="kalshiWinRate">--%</div>
          <div class="label">Win Rate</div>
        </div>
        <div class="stat-card position-stat">
          <div class="value neutral" id="kalshiPositions">--</div>
          <div class="label">Open Positions</div>
          <div class="position-tooltip" id="kalshiPositionTooltip">
            <h5>üìä Kalshi Open Positions</h5>
            <div id="kalshiPositionList"><div class="no-positions">Loading...</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Polymarket -->
    <div class="platform-card polymarket">
      <div class="platform-header">
        <div class="platform-identity">
          <div class="platform-logo">
            <img src="polymarket-logo.png" alt="Polymarket" class="platform-logo-img">
          </div>
          <div class="platform-meta">
            <h2>POLYMARKET</h2>
            <div class="timeframe">5-Min BTC | Elite-Only Mode</div>
          </div>
        </div>
        <span class="version-badge">v6.0 Elite</span>
        <div style="font-size: 10px; color: var(--text-dim); margin-top: 4px;">Stats Reset Daily at 12 AM EST</div>
      </div>
      <div class="platform-stats">
        <div class="stat-card">
          <div class="value win" id="polyWins">--</div>
          <div class="label">Wins</div>
        </div>
        <div class="stat-card">
          <div class="value loss" id="polyLosses">--</div>
          <div class="label">Losses</div>
        </div>
        <div class="stat-card">
          <div class="value neutral" id="polyWinRate">--%</div>
          <div class="label">Win Rate</div>
        </div>
        <div class="stat-card position-stat">
          <div class="value neutral" id="polyPositions">--</div>
          <div class="label">Open Positions</div>
          <div class="position-tooltip" id="polyPositionTooltip">
            <h5>üìä Polymarket Open Positions</h5>
            <div id="polyPositionList"><div class="no-positions">Loading...</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Decisions - Side by Side -->
  <div class="section-card decisions-section">
    <div class="section-header">
      <h3>üß† RECENT DECISIONS</h3>
      <span style="font-size: 12px; color: var(--text-dim);">Why we trade (or skip)</span>
    </div>
    <div class="decisions-grid">
      <!-- Kalshi Decisions -->
      <div class="decisions-column kalshi">
        <div class="decisions-column-header">
          <h4><img src="kalshi-logo.png" alt="Kalshi" class="header-logo"> KALSHI</h4>
          <span class="version">v10.3</span>
        </div>
        <div class="decisions-list" id="kalshiDecisionsList">
          <div class="loading">
            <div class="loader"></div>
            Loading...
          </div>
        </div>
      </div>
      
      <!-- Polymarket Decisions -->
      <div class="decisions-column polymarket">
        <div class="decisions-column-header">
          <h4><img src="polymarket-logo.png" alt="Polymarket" class="header-logo"> POLYMARKET</h4>
          <span class="version">v5.4</span>
        </div>
        <div class="decisions-list" id="polyDecisionsList">
          <div class="loading">
            <div class="loader"></div>
            Loading...
          </div>
        </div>
      </div>
    </div>
  </div>



  <!-- Recent Trades - Side by Side -->
  <div class="section-card">
    <div class="section-header">
      <h3>üìú RECENT TRADES</h3>
      <span style="font-size: 12px; color: var(--text-dim);">Stats Reset Daily at 12 AM EST</span>
    </div>
    <div class="trades-grid">
      <!-- Kalshi Trades -->
      <div class="trades-column kalshi">
        <div class="trades-column-header">
          <h4><img src="kalshi-logo.png" alt="Kalshi" class="header-logo"> KALSHI <span id="kalshiStreakBadge" class="streak-badge">üî• 0</span></h4>
          <span class="version">v10.3</span>
        </div>
        <div class="trades-list" id="kalshiTradesList">
          <div class="loading">
            <div class="loader"></div>
            Loading...
          </div>
        </div>
      </div>
      
      <!-- Polymarket Trades -->
      <div class="trades-column polymarket">
        <div class="trades-column-header">
          <h4><img src="polymarket-logo.png" alt="Polymarket" class="header-logo"> POLYMARKET <span id="polyStreakBadge" class="streak-badge">üî• 0</span></h4>
          <span class="version">v4.0</span>
        </div>
        <div class="trades-list" id="polyTradesList">
          <div class="loading">
            <div class="loader"></div>
            Loading...
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- How Oshi Works - Architecture Section -->
  <div class="section-card architecture-section">
    <div class="section-header">
      <h3>üß† HOW OSHI THINKS</h3>
      <span style="font-size: 12px; color: var(--text-dim);">Multi-component AI trading system</span>
    </div>
    
    <div class="arch-container">
      <!-- Top: Spirit -->
      <div class="arch-row spirit-row">
        <div class="arch-node spirit-node">
          <div class="node-glow spirit-glow"></div>
          <div class="node-icon">üëª</div>
          <div class="node-content">
            <h4>SPIRIT</h4>
            <span class="node-role">Voice & Personality</span>
            <p>Controls Twitter presence, crafts messages, represents Oshi to the world</p>
          </div>
          <div class="node-badge purple">@predictwithoshi</div>
        </div>
      </div>
      
      <!-- Connector -->
      <div class="arch-connector vertical">
        <div class="connector-line"></div>
        <div class="connector-pulse"></div>
      </div>
      
      <!-- Middle: Left Brain + Right Brain -->
      <div class="arch-row brain-row">
        <div class="arch-node left-brain-node">
          <div class="node-glow blue-glow"></div>
          <div class="node-icon">üìä</div>
          <div class="node-content">
            <h4>LEFT BRAIN</h4>
            <span class="node-role">Technical Analysis</span>
            <p>PSAR direction, ADX strength, RSI confirmation, momentum detection</p>
          </div>
          <div class="node-indicators">
            <span class="indicator">PSAR</span>
            <span class="indicator">ADX</span>
            <span class="indicator">RSI</span>
          </div>
        </div>
        
        <div class="arch-connector horizontal">
          <div class="connector-line"></div>
          <div class="data-flow">
            <span>‚óÄ</span>
            <span>üìà</span>
            <span>‚ñ∂</span>
          </div>
        </div>
        
        <div class="arch-node right-brain-node">
          <div class="node-glow teal-glow"></div>
          <div class="node-icon">üéØ</div>
          <div class="node-content">
            <h4>RIGHT BRAIN</h4>
            <span class="node-role">Decision Engine</span>
            <p>Tier classification, position sizing, entry timing, risk management</p>
          </div>
          <div class="node-indicators">
            <span class="indicator tier-s">S-Tier</span>
            <span class="indicator tier-a">A-Tier</span>
            <span class="indicator tier-b">B-Tier</span>
          </div>
        </div>
      </div>
      
      <!-- Connector -->
      <div class="arch-connector vertical split">
        <div class="connector-branch left"></div>
        <div class="connector-branch right"></div>
      </div>
      
      <!-- Bottom: Body + Heart -->
      <div class="arch-row bottom-row">
        <div class="arch-node body-node">
          <div class="node-glow gold-glow"></div>
          <div class="node-icon">üí™</div>
          <div class="node-content">
            <h4>BODY</h4>
            <span class="node-role">Trade Execution</span>
            <p>API connections, order placement, position management, exit handling</p>
          </div>
          <div class="node-platforms">
            <span class="platform kalshi">üü¢ Kalshi</span>
            <span class="platform poly">üîµ Polymarket</span>
          </div>
        </div>
        
        <div class="arch-node heart-node">
          <div class="node-glow pink-glow"></div>
          <div class="node-icon heart-beat">‚ù§Ô∏è</div>
          <div class="node-content">
            <h4>HEART</h4>
            <span class="node-role">Memory & Learning</span>
            <p>Trade logging, pattern recognition, performance analysis, strategy tuning</p>
          </div>
          <div class="node-features">
            <span class="feature">üìù Logs</span>
            <span class="feature">üîÑ Feedback</span>
            <span class="feature">üìà Analytics</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Data Flow Legend -->
    <div class="arch-legend">
      <div class="legend-item">
        <div class="legend-dot analysis"></div>
        <span>Analysis Flow</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot execution"></div>
        <span>Execution Flow</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot feedback"></div>
        <span>Learning Feedback</span>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="refresh-line">
      <span>Last updated:</span>
      <span class="refresh-time" id="lastUpdate">--</span>
    </div>
    <div class="brand-line">
      Powered by <a href="https://predictwithoshi.com">Oshi Overseer</a> ‚ú® Auto-refresh: 5m
    </div>
  </footer>

</div>

<script>

// === API ENDPOINTS ===
const API_BASE = '';
const POLY_API = '/poly-api';

// === DAILY STARTING BALANCES (Feb 19, 2026 - Fresh Start) ===
const DAILY_START = {
  kalshi: 250.00,      // Reset for fresh start
  polymarket: 355.00,  // $250 start + $105 deposit @ 4:06 PM MST
  date: '2026-02-19'
};

// Fetch Polymarket daily start balance from API
async function fetchPolyDailyStart() {
  try {
    const res = await fetch(`${POLY_API}/daily_start`);
    if (res.ok) {
      const data = await res.json();
      DAILY_START.polymarket = data.starting_balance;
      DAILY_START.date = data.date;
      // Re-run P&L update with fetched balance
      const balEl = document.getElementById('polyBalance');
      if (balEl) {
        const currentBal = parseFloat(balEl.textContent.replace('$', ''));
        if (!isNaN(currentBal)) updateDailyPnL('polymarket', currentBal);
      }
    }
  } catch (e) {
    console.error('Failed to fetch poly daily start:', e);
  }
}

function updateDailyPnL(platform, currentBalance) {
  const startBalance = DAILY_START[platform];
  if (!startBalance || startBalance <= 0) {
    // Show -- for missing data
    const pnlEl = document.getElementById(`${platform}DailyPnl`);
    const startEl = document.getElementById(`${platform}StartBalance`);
    if (pnlEl) pnlEl.textContent = '$ --';
    if (startEl) startEl.textContent = '--';
    return;
  }
  
  const pnlUsd = currentBalance - startBalance;
  const pnlPct = ((pnlUsd / startBalance) * 100);
  
  const pnlEl = document.getElementById(`${platform}DailyPnl`);
  const pctEl = document.getElementById(`${platform}DailyPct`);
  const startEl = document.getElementById(`${platform}StartBalance`);
  
  if (pnlEl) {
    const sign = pnlUsd >= 0 ? '+' : '';
    pnlEl.textContent = `${sign}$${pnlUsd.toFixed(2)}`;
    pnlEl.className = `daily-pnl ${pnlUsd >= 0 ? 'pnl-positive' : 'pnl-negative'}`;
  }
  if (pctEl) {
    const sign = pnlPct >= 0 ? '+' : '';
    pctEl.textContent = `${sign}${pnlPct.toFixed(1)}%`;
    pctEl.className = `daily-pct ${pnlUsd >= 0 ? 'pnl-positive' : 'pnl-negative'}`;
  }
  if (startEl) {
    startEl.textContent = startBalance.toFixed(2);
  }
}
// === END DAILY PNL CONFIG ===

// Generate sparkles
const bgEffects = document.querySelector('.bg-effects');
for (let i = 0; i < 15; i++) {
  const sparkle = document.createElement('div');
  sparkle.className = 'sparkle';
  sparkle.style.left = Math.random() * 100 + '%';
  sparkle.style.top = Math.random() * 100 + '%';
  sparkle.style.animationDelay = Math.random() * 3 + 's';
  sparkle.style.animationDuration = (2 + Math.random() * 2) + 's';
  bgEffects.appendChild(sparkle);
}

// Version filters - only count trades from these versions
const KALSHI_VERSION = '10.';  // Matches 10.0, 10.1, etc
const POLY_VERSION = '2.';     // Matches 2.0, 2.1, etc (displayed as v2.1)

const fmt = (n) => {
  if (n === null || n === undefined || isNaN(n)) return '$--';
  const sign = n >= 0 ? '+' : '';
  return `${sign}$${Math.abs(n).toFixed(2)}`;
};

const fmtPnl = (n, el) => {
  if (n === null || n === undefined || isNaN(n)) {
    el.textContent = '$--';
    el.className = 'value neutral';
    return;
  }
  el.textContent = fmt(n);
  el.className = n >= 0 ? 'value positive' : 'value negative';
};

// Render trade row
const renderTrade = (t, platform) => {
  // Use pnl_usd first (Polymarket), fallback to pnl (Kalshi)
  const pnl = t.pnl_usd !== undefined ? t.pnl_usd : (t.pnl || 0);
  const won = t.won === true || t.redeemed === true || t.exit_price === 100 || pnl > 0;
  const pnlClass = pnl >= 0 ? 'positive' : 'negative';
  const outcome = won ? 'win' : 'loss';
  const market = t.asset || t.ticker?.split('-')[0] || 'BTC';
  const side = t.direction || t.side?.toUpperCase() || '';
  const tier = t.tier ? `[${t.tier}]` : '';
  const timeStr = t.exit_time || t.entry_time || t.timestamp;
  const time = timeStr ? new Date(timeStr).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'}) : '';
  const logo = platform === 'kalshi' ? 'kalshi-logo.png' : 'polymarket-logo.png';
  
  return `
    <div class="trade-row ${platform}">
      <div class="trade-icon"><img src="${logo}" alt="${platform}" class="trade-logo"></div>
      <div class="trade-info">
        <div class="trade-market">${market} ${side} ${tier}</div>
        <div class="trade-meta">${time}</div>
      </div>
      <span class="trade-outcome ${outcome}">${won ? 'WIN' : 'LOSS'}</span>
      <span class="trade-pnl ${pnlClass}">${fmt(pnl)}</span>
    </div>
  `;
};

// Update Kalshi
const updateKalshi = async () => {
  try {
    // Get trades and filter by version + daily reset
    const tradesRes = await fetch(`${API_BASE}/api/trades`);
    let trades = [];
    let wins = 0, losses = 0, pnl = 0, winStreak = 0;
    
    if (tradesRes.ok) {
      const data = await tradesRes.json();
      
      // Daily reset at 12 AM EST / midnight (5:00 UTC)
      const now = new Date();
      const resetTime = new Date(now);
      resetTime.setUTCHours(5, 0, 0, 0); // 12 AM EST = 5:00 UTC
      if (now.getUTCHours() < 5) {
        resetTime.setDate(resetTime.getDate() - 1); // Yesterday's midnight if before 5 UTC
      }
      
      trades = (data.trades || []).filter(t => {
        // Version filter: v10.x only
        const ver = String(t.version || '');
        if (!ver.includes('10.') && !ver.startsWith('10.')) return false;
        
        // Daily reset: only show trades since 12 AM EST
        const tradeTime = new Date(t.exit_time || t.timestamp);
        if (tradeTime < resetTime) return false;
        
        return true;
      });
      
      // Calculate stats from filtered trades (use pnl_usd)
      for (const t of trades) {
        const tradePnl = t.pnl_usd !== undefined ? t.pnl_usd : (t.pnl || 0);
        const won = t.won === true || tradePnl > 0;
        if (won) wins++; else losses++;
        pnl += tradePnl;
      }
      
      // Calculate current win streak (most recent trades first)
      const sortedTrades = [...trades].sort((a, b) => 
        new Date(b.exit_time || b.timestamp) - new Date(a.exit_time || a.timestamp)
      );
      for (const t of sortedTrades) {
        const tradePnl = t.pnl_usd !== undefined ? t.pnl_usd : (t.pnl || 0);
        const won = t.won === true || tradePnl > 0;
        if (won) winStreak++;
        else break; // Stop at first loss
      }
    }
    
    document.getElementById('kalshiWins').textContent = wins;
    document.getElementById('kalshiLosses').textContent = losses;
    const total = wins + losses;
    document.getElementById('kalshiWinRate').textContent = total > 0 ? Math.round(wins / total * 100) + '%' : '--%';
    
    // Update streak badge
    const kalshiStreakEl = document.getElementById('kalshiStreakBadge');
    kalshiStreakEl.textContent = `üî• ${winStreak}`;
    kalshiStreakEl.className = winStreak >= 3 ? 'streak-badge hot' : 'streak-badge';
    
    // Get open positions with details
    try {
      const posRes = await fetch(`${API_BASE}/api/positions`);
      if (posRes.ok) {
        const posData = await posRes.json();
        // Filter to only truly open positions (position != 0, negative = NO side)
        const positions = (posData.positions || []).filter(p => p.position !== 0);
        document.getElementById('kalshiPositions').textContent = positions.length;
        
        // Populate tooltip
        const listEl = document.getElementById('kalshiPositionList');
        if (positions.length === 0) {
          listEl.innerHTML = '<div class="no-positions">No open positions</div>';
        } else {
          listEl.innerHTML = positions.map(p => {
            const ticker = p.ticker || '';
            const asset = ticker.includes('BTC') ? 'BTC' : ticker.includes('SOL') ? 'SOL' : '?';
            // Extract time from ticker like KXBTC15M-26FEB151215-15
            const parts = ticker.split('-');
            const timePart = parts.length >= 2 ? parts[1].slice(-4) : '';
            const hour = timePart.slice(0, 2);
            const min = timePart.slice(2, 4);
            const window = hour && min ? `${hour}:${min}` : '?';
            const rawContracts = p.position || 0;
            const contracts = Math.abs(rawContracts);
            const side = rawContracts < 0 ? 'NO' : 'YES';
            const buyIn = parseFloat(p.market_exposure_dollars || 0).toFixed(2);
            const price = contracts > 0 ? Math.round(parseFloat(buyIn) * 100 / contracts) : 0;
            const potentialWin = ((100 - price) * contracts / 100).toFixed(2);
            return `
              <div class="position-item">
                <span class="position-asset">${asset} ${window}</span>
                <div class="position-details">
                  <div class="direction ${side === 'NO' ? 'down' : ''}">${side}</div>
                  <div class="entry">${contracts} @ ${price}¬¢ ¬∑ $${buyIn}</div>
                  <div class="potential">Win: +$${potentialWin}</div>
                </div>
              </div>
            `;
          }).join('');
        }
      } else {
        document.getElementById('kalshiPositions').textContent = '0';
        document.getElementById('kalshiPositionList').innerHTML = '<div class="no-positions">No open positions</div>';
      }
    } catch (e) {
      document.getElementById('kalshiPositions').textContent = '0';
      document.getElementById('kalshiPositionList').innerHTML = '<div class="no-positions">Error loading</div>';
    }
    
    // Render trades
    const container = document.getElementById('kalshiTradesList');
    if (trades.length === 0) {
      container.innerHTML = '<div class="no-trades">‚ú® No v10.3 trades yet</div>';
    } else {
      container.innerHTML = trades.slice(0, 8).map(t => renderTrade(t, 'kalshi')).join('');
    }
    
    // Balance
    const balRes = await fetch(`${API_BASE}/api/balance`);
    if (balRes.ok) {
      const balData = await balRes.json();
      const bal = balData.balance_cents ? balData.balance_cents / 100 : balData.balance;
      document.getElementById('kalshiBalance').textContent = `$${bal.toFixed(2)}`;
      updateDailyPnL('kalshi', bal);
    }
  } catch (e) {
    console.error('Kalshi error:', e);
  }
};

// Update Polymarket
const updatePolymarket = async () => {
  try {
    // Get trades and filter by version + resolution status
    const tradesRes = await fetch(`${POLY_API}/trades?limit=200`);
    let trades = [];
    let wins = 0, losses = 0, pnl = 0, winStreak = 0;
    
    if (tradesRes.ok) {
      const data = await tradesRes.json();
      // Daily reset at 12 AM EST / midnight (5:00 UTC)
      const now = new Date();
      const resetTime = new Date(now);
      resetTime.setUTCHours(5, 0, 0, 0); // 12 AM EST = 5:00 UTC
      if (now.getUTCHours() < 5) {
        resetTime.setDate(resetTime.getDate() - 1); // Yesterday's midnight if before 5 UTC
      }
      
      trades = (data.trades || []).filter(t => {
        // Daily reset: only show trades since 12 AM EST (version-agnostic)
        const tradeTime = new Date(t.exit_time || t.entry_time);
        if (tradeTime < resetTime) return false;
        
        // Trade is resolved if it has an exit_time (v4.x exits early, not at 0/100)
        const isResolved = !!t.exit_time;
        
        return isResolved;
      });
      
      // Calculate stats from filtered trades (v4.x: win = positive pnl)
      for (const t of trades) {
        const isWin = t.won === true || (t.pnl_usd && t.pnl_usd > 0);
        if (isWin) wins++;
        else losses++;
        pnl += t.pnl_usd || 0;
      }
      
      // Calculate current win streak (most recent trades first)
      const sortedTrades = [...trades].sort((a, b) => 
        new Date(b.exit_time || b.entry_time) - new Date(a.exit_time || a.entry_time)
      );
      for (const t of sortedTrades) {
        const isWin = t.won === true || (t.pnl_usd && t.pnl_usd > 0);
        if (isWin) winStreak++;
        else break; // Stop at first loss
      }
    }
    
    document.getElementById('polyWins').textContent = wins;
    document.getElementById('polyLosses').textContent = losses;
    const total = wins + losses;
    document.getElementById('polyWinRate').textContent = total > 0 ? Math.round(wins / total * 100) + '%' : '--%';
    
    // Update streak badge
    const polyStreakEl = document.getElementById('polyStreakBadge');
    polyStreakEl.textContent = `üî• ${winStreak}`;
    polyStreakEl.className = winStreak >= 3 ? 'streak-badge hot' : 'streak-badge';
    
    // Get open positions with details
    try {
      const posRes = await fetch(`${POLY_API}/positions`);
      if (posRes.ok) {
        const posData = await posRes.json();
        const positions = posData.positions || [];
        document.getElementById('polyPositions').textContent = positions.length;
        
        // Populate tooltip
        const listEl = document.getElementById('polyPositionList');
        if (positions.length === 0) {
          listEl.innerHTML = '<div class="no-positions">No open positions</div>';
        } else {
          listEl.innerHTML = positions.map(p => {
            const asset = p.asset || 'BTC';
            const direction = p.direction || '?';
            const dirClass = direction === 'DOWN' ? 'down' : '';
            const entryPrice = p.entry_price || 50;
            const sizeUsd = p.size_usd || 5;
            const shares = (sizeUsd / (entryPrice / 100)).toFixed(1);
            const potentialWin = ((100 - entryPrice) / 100 * parseFloat(shares)).toFixed(2);
            const entryTime = p.entry_time ? new Date(p.entry_time).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'}) : '';
            return `
              <div class="position-item">
                <span class="position-asset">${asset} ${entryTime}</span>
                <div class="position-details">
                  <div class="direction ${dirClass}">${direction}</div>
                  <div class="entry">${shares} @ ${entryPrice}¬¢ ¬∑ $${sizeUsd}</div>
                  <div class="potential">Win: +$${potentialWin}</div>
                </div>
              </div>
            `;
          }).join('');
        }
      } else {
        document.getElementById('polyPositions').textContent = '0';
        document.getElementById('polyPositionList').innerHTML = '<div class="no-positions">No open positions</div>';
      }
    } catch (e) {
      document.getElementById('polyPositions').textContent = '0';
      document.getElementById('polyPositionList').innerHTML = '<div class="no-positions">Error loading</div>';
    }
    
    // Render only resolved trades
    const container = document.getElementById('polyTradesList');
    if (trades.length === 0) {
      container.innerHTML = '<div class="no-trades">‚ú® No resolved trades yet</div>';
    } else {
      container.innerHTML = trades.slice(0, 8).map(t => renderTrade(t, 'polymarket')).join('');
    }
    
    // Balance and unredeemed
    try {
      const statsRes = await fetch(`${POLY_API}/stats`);
      if (statsRes.ok) {
        const statsData = await statsRes.json();
        const balance = statsData.balance || 0;
        const unredeemed = statsData.unredeemed_pnl || 0;
        const total = balance + unredeemed;
        
        // Update balance display
        document.getElementById('polyBalance').textContent = `$${balance.toFixed(2)}`;
        updateDailyPnL('polymarket', balance);
        
        // Update unredeemed display
        const unredeemedRow = document.getElementById('polyUnredeemedRow');
        if (unredeemedRow) {
          if (unredeemed > 0) {
            document.getElementById('polyUnredeemed').textContent = unredeemed.toFixed(2);
            document.getElementById('polyTotalValue').textContent = total.toFixed(2);
            unredeemedRow.style.display = 'block';
          } else {
            unredeemedRow.style.display = 'none';
          }
        }
      }
    } catch (e) {}
  } catch (e) {
    console.error('Poly error:', e);
  }
};

const updateTimestamp = () => {
  document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
};

// Render decision row
const renderDecision = (d, platform) => {
  const willTrade = d.will_trade || d.direction;
  const outcome = willTrade ? 'trade' : 'skip';
  const outcomeText = willTrade ? `TRADE ${d.direction || ''}` : 'SKIP';
  const market = d.market || d.slug || 'BTC';
  const time = d.timestamp ? new Date(d.timestamp).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit', second: '2-digit'}) : '';
  
  let indicators = '';
  
  // PSAR
  if (d.psar || d.scan1_psar) {
    const psar = d.psar || d.scan1_psar;
    const psarClass = psar === 'UP' ? 'up' : psar === 'DOWN' ? 'down' : 'neutral';
    indicators += `<span class="indicator-tag ${psarClass}">PSAR: ${psar}</span>`;
  }
  
  // RSI
  const rsi = d.rsi || d.scan1_rsi;
  if (rsi !== undefined) {
    const rsiVal = typeof rsi === 'number' ? rsi.toFixed(1) : rsi;
    const rsiBias = d.rsi_bias || '';
    const rsiClass = (rsiBias + '').includes('UP') ? 'up' : (rsiBias + '').includes('DOWN') ? 'down' : 'neutral';
    indicators += `<span class="indicator-tag ${rsiClass}">RSI: ${rsiVal}</span>`;
  }
  
  // Confluence
  const conf = d.confluence || (d.scans_agree ? 2 : 1);
  indicators += `<span class="confluence-badge">${conf}/2</span>`;
  
  const reason = d.reason || d.skip_reason || '';
  
  return `
    <div class="decision-row ${outcome}">
      <div class="decision-header">
        <span class="decision-market">${market}</span>
        <span class="decision-time">${time}</span>
      </div>
      <div class="decision-indicators">
        ${indicators}
        <span class="decision-outcome ${outcome}">${outcomeText}</span>
      </div>
      ${reason ? `<div class="decision-reason">${reason}</div>` : ''}
    </div>
  `;
};

// Update Kalshi decisions
const updateKalshiDecisions = async () => {
  try {
    const res = await fetch(`${API_BASE}/api/decisions`);
    if (res.ok) {
      const data = await res.json();
      const decisions = data.decisions || [];
      const listEl = document.getElementById('kalshiDecisionsList');
      
      if (decisions.length === 0) {
        listEl.innerHTML = '<div class="no-positions">No recent decisions</div>';
      } else {
        listEl.innerHTML = decisions.slice(0, 10).map(d => renderDecision(d, 'kalshi')).join('');
      }
    }
  } catch (e) {
    console.log('Kalshi decisions fetch error:', e);
    document.getElementById('kalshiDecisionsList').innerHTML = '<div class="no-positions">API unavailable</div>';
  }
};

// Update Polymarket decisions
const updatePolyDecisions = async () => {
  try {
    const res = await fetch(`${POLY_API}/decisions`);
    if (res.ok) {
      const data = await res.json();
      const decisions = data.decisions || [];
      const listEl = document.getElementById('polyDecisionsList');
      
      if (decisions.length === 0) {
        listEl.innerHTML = '<div class="no-positions">No recent decisions</div>';
      } else {
        listEl.innerHTML = decisions.slice(0, 10).map(d => renderDecision(d, 'polymarket')).join('');
      }
    }
  } catch (e) {
    console.log('Poly decisions fetch error:', e);
    document.getElementById('polyDecisionsList').innerHTML = '<div class="no-positions">API unavailable</div>';
  }
};

const updateAll = async () => {
  // Fetch dynamic starting balances first
  await fetchPolyDailyStart();
  await Promise.all([updateKalshi(), updatePolymarket(), updateKalshiDecisions(), updatePolyDecisions()]);
  updateTimestamp();
};

updateAll();
setInterval(updateAll, 300000); // 5 minutes

// Mobile tap handling for position tooltips
document.querySelectorAll('.position-stat').forEach(el => {
  el.addEventListener('click', (e) => {
    e.stopPropagation();
    // Close any other open tooltips
    document.querySelectorAll('.position-stat.active').forEach(other => {
      if (other !== el) other.classList.remove('active');
    });
    // Toggle this one
    el.classList.toggle('active');
  });
});

// Close tooltip when tapping outside
document.addEventListener('click', () => {
  document.querySelectorAll('.position-stat.active').forEach(el => {
    el.classList.remove('active');
  });
});
</script>

</body>
</html>
<!-- Last deploy: 2026-02-18T02:51:21Z -->
<!-- Force redeploy Thu Feb 19 16:34:24 MST 2026 -->
